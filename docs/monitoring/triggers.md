# 预警规则与触发条件

本文档列出了当前系统中配置的所有自动监控规则。

> 📖 **相关文档**: [A3 Trigger 系统技术架构](./a3_trigger_architecture.md) - 完整的系统架构、数据流和开发路线图

## 1. 规则汇总表

规则配置文件位于: `data_pipelines/monitoring/config/kpi_rules.csv`

| 规则代码 | 监控指标 | 触发条件 | 连续周数 | 级别 | 处置动作 | 状态 |
|:---------|:---------|:---------|:--------:|:-----|:---------|:-----|
| **SA_GLOBAL_CRITICAL** | SA (达成率) | < 92% | **4** | 🔴 Critical | **创建 A3 案卷** | ✅ Active |
| **SAFETY_RANK_CRITICAL** | 安全排名 (Safety) | 排名前 3 | 3 | 🔴 Critical | **创建 A3 案卷 (2026起)** | ✅ Active |
| *其他规则* | - | - | - | - | - | ⚪ Inactive |

> *注: 目前仅启用以上两项核心规则。其他规则（如 Warning 级别或工厂级规则）暂时处于非激活状态。*
> *注: 安全排名规则仅针对 '安全' 储存桶中的任务，起始于 2026-01-01。*

## 2. 规则详解

### 2.1 LT (Lead Time) 异常
监控制造周期是否过长。
- **阈值**: 24小时。
- **逻辑**: 如果某个工艺组 (Tag) 的平均周期连续 N 周都超过 24 小时，视为系统性异常。

### 2.2 SA (Schedule Adherence) 异常
监控计划执行率。
- **阈值**: 95%。
- **逻辑**: 连续 N 周低于 95% 意味着生产持续脱节，需要介入。

### 2.3 Safety Rank (安全隐患)
监控高频安全问题。
- **逻辑**: 如果某种类型的安全隐患（如“操作不当”）连续 3 周都在隐患排行榜前 3 名，说明整改未见效。

## 3. 触发机制详情

### N 周连续 (Consecutive Occurrences)
为了避免单一数据的偶然波动干扰，主要规则都要求**连续性**。
- 例如 "连续 3 周": W40, W41, W42 都违规 ➜ **W42 触发报警**。
- 如果 W40 违规, W41 正常, W42 违规 ➜ **不触发** (计数器重置)。

### 报警升级 (Escalation)
- **第 2 周**: 先触发 Warning (邮件提醒)，作为预警。
- **第 3 周**: 如果情况未改善，升级为 Critical (生成 A3)，强制介入。
