# 预警规则与触发条件

本文档列出了当前系统中配置的所有自动监控规则。

## 1. 规则汇总表

规则配置文件位于: `data_pipelines/monitoring/config/kpi_rules.csv`

| 规则代码 | 监控指标 | 触发条件 | 连续周数 | 级别 | 处置动作 |
|:---------|:---------|:---------|:--------:|:-----|:---------|
| **LT_GLOBAL_WARNING** | Lead Time (周期) | > 24 小时 | 2 | 🟡 Warning | 发送邮件 |
| **LT_GLOBAL_CRITICAL** | Lead Time (周期) | > 24 小时 | **3** | 🔴 Critical | **创建 A3 案卷** |
| **SA_GLOBAL_WARNING** | SA (达成率) | < 95% | 2 | 🟡 Warning | 发送邮件 |
| **SA_GLOBAL_CRITICAL** | SA (达成率) | < 95% | **3** | 🔴 Critical | **创建 A3 案卷** |
| **SAFETY_RANK_CRITICAL** | 安全隐患 (Safety) | 排名前 3 | 3 | 🔴 Critical | **创建 A3 案卷** |

> *注: 不同厂区 (如 CZM, CKH) 可能有独立的规则配置，逻辑同上。*

## 2. 规则详解

### 2.1 LT (Lead Time) 异常
监控制造周期是否过长。
- **阈值**: 24小时。
- **逻辑**: 如果某个工艺组 (Tag) 的平均周期连续 N 周都超过 24 小时，视为系统性异常。

### 2.2 SA (Schedule Adherence) 异常
监控计划执行率。
- **阈值**: 95%。
- **逻辑**: 连续 N 周低于 95% 意味着生产持续脱节，需要介入。

### 2.3 Safety Rank (安全隐患)
监控高频安全问题。
- **逻辑**: 如果某种类型的安全隐患（如“操作不当”）连续 3 周都在隐患排行榜前 3 名，说明整改未见效。

## 3. 触发机制详情

### N 周连续 (Consecutive Occurrences)
为了避免单一数据的偶然波动干扰，主要规则都要求**连续性**。
- 例如 "连续 3 周": W40, W41, W42 都违规 ➜ **W42 触发报警**。
- 如果 W40 违规, W41 正常, W42 违规 ➜ **不触发** (计数器重置)。

### 报警升级 (Escalation)
- **第 2 周**: 先触发 Warning (邮件提醒)，作为预警。
- **第 3 周**: 如果情况未改善，升级为 Critical (生成 A3)，强制介入。
