# 常见问题 FAQ

本页面汇总了用户在使用数据平台过程中的常见问题及解答。

---

## SA 指标相关

### Q1: SA 指标的计算是在 ETL 还是 Power BI？

**A:** 所有 SA 指标的计算都在 **ETL 阶段完成**（`etl_sa.py` 脚本）。

- ✅ **已在 ETL 计算**：LT(d)、PT(d)、ST(d)、DueTime、Weekend(d)、CompletionStatus
- ✅ **Power BI 直接读取**：无需二次计算，提高性能
- ✅ **数据一致性**：所有报表使用相同的计算逻辑

!!! tip "建议"
    如需修改计算逻辑，请修改 ETL 脚本，不要在 Power BI 中重新计算。

---

### Q2: 为什么 LT 和 PT 不扣除周末？

**A:** 这是业务设计决策：

- **LT（Lead Time）**：反映实际经过的日历时间，包括周末
- **PT（Process Time）**：反映实际加工时间，包括周末
- **ST（Standard Time）**：理论加工时间，不考虑周末
- **DueTime**：计划完工时间，**会跳过周末**（基于工作日日历，采用24小时连续工作制）

!!! example "示例"
    如果批次周五开始，周一报工：
    
    - LT/PT = 3 天（包括周六、周日）
    - DueTime 计算时会跳过周六、周日，每个工作日按24小时计算

---

### Q3: 0010 工序为什么要特殊处理？

**A:** 0010 工序是首道工序，具有特殊性：

1. **Checkin_SFC 优先级最高**
   - 0010 工序：Checkin_SFC → EnterStepTime → TrackInTime
   - 其他工序：EnterStepTime

2. **业务含义**
   - Checkin_SFC 是批次正式进入生产的时间点
   - 比 EnterStepTime 更准确

!!! note "数据来源"
    Checkin_SFC 来自 SFC 系统，通过 ETL 合并到 MES 数据中。

---

### Q4: OEE 为什么默认值是 77%？

**A:** 这是基于历史数据统计的行业经验值：

- 如果标准时间表中 OEE 为空或 0，系统自动使用 **0.77**
- 代表设备综合效率约 77%
- 可通过配置文件修改默认值

!!! warning "注意"
    标准时间表中应尽量填写实际 OEE 值，避免使用默认值。

---

### Q: SA 计算采用多少小时工作制？

**A:** SA 计算采用 **24 小时连续工作制**：

- **DueTime 计算**：每个工作日按 24 小时计算
- **非工作日**：完全跳过（周末和法定节假日）
- **业务逻辑**：反映实际连续生产情况

!!! info "计算示例"
    如果标准时间 ST = 72 小时：
    - 需要 3 个完整工作日（3 × 24 = 72 小时）
    - 中间的周末会被跳过，不计入工作时间

---

### Q5: 换批（Setup）是如何判断的？

**A:** 换批判断逻辑：

```python
if PreviousBatchEndTime is None:
    Setup = "Yes"  # 第一批次
elif CFN == 上一批次的CFN:
    Setup = "No"   # 同一产品
else:
    Setup = "Yes"  # 产品切换
```

**判断依据：**
- 同一机台的连续批次
- 产品号（CFN）是否变化

!!! info "换批影响"
    Setup = "Yes" 时，会增加调试时间（Setup Time）

---

## 数据处理相关

### Q6: 为什么使用 Parquet 格式？

**A:** Parquet 格式有以下优势：

| 特性 | Parquet | Excel/CSV |
|------|---------|-----------|
| 文件大小 | 小 70-90% | 大 |
| 读取速度 | 快 5-10 倍 | 慢 |
| 数据类型 | 精确保留 | 易丢失 |
| Power BI 支持 | ✅ 原生支持 | ✅ 支持但慢 |

!!! success "性能提升"
    使用 Parquet 后，Power BI 刷新时间从 10 分钟减少到 1-2 分钟。

---

### Q7: 如何更新数据？

**A:** 数据更新流程：

1. **下载最新 MES/SFC 文件**
2. **上传到 SharePoint 对应文件夹**
3. **运行 ETL 脚本**（双击 `.bat` 文件）
4. **等待处理完成**（生成 Parquet 文件）
5. **在 Power BI 中刷新数据**

详细步骤请参考：[数据更新流程](data-update.md)

---

### Q8: ETL 处理需要多长时间？

**A:** 处理时间取决于数据量：

| 数据量 | 处理时间 | 备注 |
|--------|----------|------|
| < 1万条 | 1-2 分钟 | 快速 |
| 1-10万条 | 3-5 分钟 | 正常 |
| > 10万条 | 5-15 分钟 | 较慢 |

!!! tip "优化建议"
    - 使用增量更新而非全量更新
    - 清理历史备份文件
    - 升级服务器配置

---

### Q9: 如何知道 ETL 是否成功？

**A:** 检查方法：

1. **查看日志文件**
   ```
   logs/etl_sa.log
   logs/etl_sfc.log
   ```

2. **检查输出文件**
   - 是否生成新的 Parquet 文件？
   - 文件大小是否合理？
   - 文件时间戳是否最新？

3. **检查 Power BI**
   - 刷新数据是否成功？
   - 数据量是否正确？

详细排查请参考：[故障排查指南](troubleshooting.md)

---

## Power BI 相关

### Q10: Power BI 刷新失败怎么办？

**A:** 常见原因和解决方法：

| 错误信息 | 可能原因 | 解决方法 |
|----------|----------|----------|
| "文件未找到" | Parquet 文件路径错误 | 检查 Power Query 中的文件路径 |
| "权限不足" | SharePoint 权限问题 | 联系管理员授权 |
| "内存不足" | 数据量过大 | 使用增量刷新 |
| "超时" | 网络或性能问题 | 增加超时时间或优化查询 |

---

### Q11: 如何优化 Power BI 性能？

**A:** 优化建议：

1. **使用增量刷新**
   - 参考：[增量刷新方案](../pq/incremental-refresh.md)
   - 只刷新最近数据（如最近 90 天）

2. **减少计算列**
   - 计算已在 ETL 完成
   - 避免在 Power BI 中重复计算

3. **优化数据模型**
   - 删除不用的列
   - 使用合适的数据类型
   - 建立适当的关系

4. **使用 Parquet 格式**
   - 已在使用中
   - 比 Excel/CSV 快 5-10 倍

---

### Q12: 为什么 Power BI 中看不到最新数据？

**A:** 检查清单：

- [ ] ETL 是否已运行？
- [ ] Parquet 文件是否已生成？
- [ ] Power BI 是否已刷新？
- [ ] 数据筛选器是否正确？
- [ ] 日期范围是否包含最新数据？

---

## 配置相关

### Q13: 如何修改 ETL 配置？

**A:** 配置文件位置：

```
10-SA指标/13-SA数据清洗/config/config.yaml
```

常用配置：

```yaml
# 默认 OEE
default_oee: 0.77

# 换批时间（小时）
setup_time_buffer: 0.5

# 每日工作时间（小时）
daily_work_hours: 8

# 文件路径
input_path: "输入文件夹路径"
output_path: "输出文件夹路径"
```

详细说明请参考：[配置说明](../etl/configuration.md)

---

### Q14: 如何更新工作日日历？

**A:** 使用日历生成脚本：

```bash
python generate_calendar.py --year 2026
```

或修改 `日历工作日表.csv` 文件：

| 日期 | 星期几 | 是否工作日 | 节假日名称 |
|------|--------|------------|------------|
| 2026-01-01 | 星期四 | False | 元旦 |
| 2026-01-02 | 星期五 | True | |

---

## 数据质量相关

### Q15: 为什么有些批次没有 Checkin_SFC？

**A:** 可能的原因：

1. **SFC 数据缺失**
   - 该批次未在 SFC 系统 Check In
   - SFC 数据导出不完整

2. **匹配失败**
   - BatchNumber 或 Operation 不一致
   - 数据格式问题

3. **解决方法**
   - 使用 EnterStepTime 或 TrackInTime 作为备用
   - ETL 脚本已自动处理

---

### Q16: 为什么有些批次没有标准时间参数？

**A:** 可能的原因：

1. **标准时间表缺失**
   - 新产品还未录入标准时间
   - CFN 或 Operation 编码不一致

2. **解决方法**
   - 补充标准时间表
   - 检查 CFN 和 Operation 编码规范
   - ETL 日志会记录缺失记录

---

### Q17: 数据中有异常值怎么办？

**A:** 异常值处理：

1. **识别异常**
   - LT/PT 异常大或小
   - DueTime 早于 TrackInTime
   - 数量为负数

2. **排查原因**
   - 查看原始数据
   - 检查 ETL 日志
   - 验证时间逻辑

3. **处理方法**
   - 修正原始数据
   - 更新 ETL 脚本
   - 在 Power BI 中筛选

---

## 其他问题

### Q18: 如何导出数据？

**A:** 导出方法：

1. **从 Power BI 导出**
   - 可视化 → 更多选项 → 导出数据

2. **从 Parquet 文件读取**
   ```python
   import pandas as pd
   df = pd.read_parquet('MES_处理后数据_latest.parquet')
   df.to_excel('导出数据.xlsx', index=False)
   ```

---

### Q19: 如何获取技术支持？

**A:** 联系方式：

- **数据平台技术支持组**
- **CZ Ops 数字化团队**
- **查看文档**：[故障排查](troubleshooting.md)

---

### Q20: 如何贡献文档改进建议？

**A:** 欢迎提供反馈：

1. 记录问题或建议
2. 联系项目团队
3. 我们会持续更新文档

---

## 找不到答案？

如果您的问题未在此列出：

1. 📖 **搜索文档**：使用顶部搜索功能
2. 🛠️ **故障排查**：参考 [故障排查指南](troubleshooting.md)
3. 📞 **联系支持**：联系技术支持团队

---

!!! question "有更多问题？"
    欢迎将您的问题反馈给我们，帮助我们完善文档！

