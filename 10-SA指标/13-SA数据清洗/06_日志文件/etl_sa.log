2025-11-21 12:24:15,147 - INFO - ============================================================
2025-11-21 12:24:15,148 - INFO - 用户选择: 全量刷新
2025-11-21 12:24:15,148 - INFO - ============================================================
2025-11-21 12:24:15,149 - INFO - 测试模式已启用，将仅读取前 50000 行数据
2025-11-21 12:24:15,149 - INFO - 读取MES数据: C:\Users\huangk14\OneDrive - Medtronic PLC\CZ Production - 文档\General\POWER BI 数据源 V2\30-MES导出数据\Product Output -CZM -FY26.xlsx
2025-11-21 12:25:05,140 - INFO - 测试模式：仅读取前 50000 行数据
2025-11-21 12:25:07,657 - INFO - 执行全量刷新：清除状态文件和历史数据文件
2025-11-21 12:25:07,660 - INFO - 已删除状态文件: C:\Users\huangk14\OneDrive - Medtronic PLC\CZ Production - 文档\General\POWER BI 数据源 V2\30-MES导出数据\publish\etl_mes_state.json
2025-11-21 12:25:07,663 - INFO - 已删除历史数据文件: C:\Users\huangk14\OneDrive - Medtronic PLC\CZ Production - 文档\General\POWER BI 数据源 V2\30-MES导出数据\publish\MES_batch_report_latest.parquet
2025-11-21 12:25:07,933 - INFO - 读取SFC数据: 20485 行
2025-11-21 12:25:08,036 - INFO - 合并SFC数据完成: 47073 行，匹配到Checkin_SFC: 6135 行
2025-11-21 12:25:08,045 - INFO - 使用标准时间表: SAP_Routing_latest.parquet
2025-11-21 12:25:08,091 - INFO - 读取合并后的标准时间表: 38293 行
2025-11-21 12:25:08,340 - INFO - 第一步Material Number匹配后，还有 10 条记录未匹配，尝试使用CFN匹配
2025-11-21 12:25:08,392 - INFO - 合并标准时间数据完成: 47076 行，总匹配成功: 47066 行
2025-11-21 12:25:08,394 - INFO - 匹配到EH_machine(s): 47066 行
2025-11-21 12:25:08,394 - INFO - 匹配到EH_labor(s): 47066 行
2025-11-21 12:25:08,396 - INFO - 匹配到OEE: 47076 行
2025-11-21 12:25:08,458 - INFO - 成功加载日历表: C:\Users\huangk14\OneDrive - Medtronic PLC\CZ Production - 文档\General\POWER BI 数据源 V2\30-MES导出数据\publish\日历工作日表.csv, 共1095条记录
2025-11-21 12:25:08,491 - INFO - 开始计算 PreviousBatchEndTime：有效machine记录 47076 条，总计 47076 条
2025-11-21 12:25:08,712 - INFO - 计算 PreviousBatchEndTime 完成：总计 47076 条，成功计算 47076 条（其中有效machine记录 47076 条）
2025-11-21 12:25:24,922 - INFO - MES数据字段筛选完成：保留 31 个字段
2025-11-21 12:25:24,928 - INFO - 历史数据文件不存在，直接使用新数据
2025-11-21 12:25:24,929 - INFO - 对所有合并后的数据统一计算 PreviousBatchEndTime
2025-11-21 12:25:24,942 - INFO - 开始计算 PreviousBatchEndTime：有效machine记录 47076 条，总计 47076 条
2025-11-21 12:25:25,083 - INFO - 计算 PreviousBatchEndTime 完成：总计 47076 条，成功计算 47076 条（其中有效machine记录 47076 条）
2025-11-21 12:25:25,097 - INFO - 已转换日期列 TrackOutDate 为datetime类型
2025-11-21 12:25:25,323 - INFO - 已保存Parquet文件: C:\Users\huangk14\OneDrive - Medtronic PLC\CZ Production - 文档\General\POWER BI 数据源 V2\30-MES导出数据\publish\MES_batch_report_latest.parquet, 行数: 47076
2025-11-21 12:25:49,713 - INFO - 已保存Excel验证文件: C:\Users\huangk14\OneDrive - Medtronic PLC\CZ Production - 文档\General\POWER BI 数据源 V2\30-MES导出数据\publish\excel\MES_batch_report_latest.xlsx, 行数: 47076
2025-11-21 12:25:50,069 - INFO - ETL状态已更新: 总记录 46968, 新增 46968 条
2025-11-21 12:25:50,077 - INFO - 增量处理：已保存到latest文件并更新状态
2025-11-21 12:25:50,078 - INFO - 处理完成，耗时: 94.93秒
2025-11-21 13:49:22,550 - INFO - ============================================================
2025-11-21 13:49:22,552 - INFO - 用户选择: 全量刷新
2025-11-21 13:49:22,553 - INFO - ============================================================
2025-11-21 13:49:22,554 - INFO - 读取MES数据: C:\Users\huangk14\OneDrive - Medtronic PLC\CZ Production - 文档\General\POWER BI 数据源 V2\30-MES导出数据\Product Output -CZM -FY26.xlsx
2025-11-21 13:50:12,534 - INFO - 执行全量刷新：清除状态文件和历史数据文件
2025-11-21 13:50:12,538 - INFO - 已删除状态文件: C:\Users\huangk14\OneDrive - Medtronic PLC\CZ Production - 文档\General\POWER BI 数据源 V2\30-MES导出数据\publish\etl_mes_state.json
2025-11-21 13:50:12,542 - INFO - 已删除历史数据文件: C:\Users\huangk14\OneDrive - Medtronic PLC\CZ Production - 文档\General\POWER BI 数据源 V2\30-MES导出数据\publish\MES_batch_report_latest.parquet
2025-11-21 13:50:13,087 - INFO - 读取SFC数据: 20485 行
2025-11-21 13:50:13,227 - INFO - 合并SFC数据完成: 107574 行，匹配到Checkin_SFC: 0 行
2025-11-21 13:50:13,243 - INFO - 使用标准时间表: SAP_Routing_latest.parquet
2025-11-21 13:50:13,282 - INFO - 读取合并后的标准时间表: 38293 行
2025-11-21 13:50:13,625 - INFO - 第一步Material Number匹配后，还有 107574 条记录未匹配，尝试使用CFN匹配
2025-11-21 13:50:14,041 - INFO - 合并标准时间数据完成: 107574 行，总匹配成功: 0 行
2025-11-21 13:50:14,042 - INFO - 匹配到EH_machine(s): 0 行
2025-11-21 13:50:14,042 - INFO - 匹配到EH_labor(s): 0 行
2025-11-21 13:50:14,043 - INFO - 匹配到OEE: 107574 行
2025-11-21 13:50:14,195 - INFO - 成功加载日历表: C:\Users\huangk14\OneDrive - Medtronic PLC\CZ Production - 文档\General\POWER BI 数据源 V2\30-MES导出数据\publish\日历工作日表.csv, 共1095条记录
2025-11-21 13:50:14,251 - INFO - 开始计算 PreviousBatchEndTime：有效machine记录 107574 条，总计 107574 条
2025-11-21 13:50:14,746 - INFO - 计算 PreviousBatchEndTime 完成：总计 107574 条，成功计算 107574 条（其中有效machine记录 107574 条）
2025-11-21 13:50:32,277 - INFO - MES数据字段筛选完成：保留 31 个字段
2025-11-21 13:50:32,308 - INFO - 历史数据文件不存在，直接使用新数据
2025-11-21 13:50:32,315 - INFO - 对所有合并后的数据统一计算 PreviousBatchEndTime
2025-11-21 13:50:32,348 - INFO - 开始计算 PreviousBatchEndTime：有效machine记录 107574 条，总计 107574 条
2025-11-21 13:50:32,922 - INFO - 计算 PreviousBatchEndTime 完成：总计 107574 条，成功计算 107574 条（其中有效machine记录 107574 条）
2025-11-21 13:50:32,976 - INFO - 已转换日期列 TrackOutDate 为datetime类型
2025-11-21 13:50:33,875 - INFO - 已保存Parquet文件: C:\Users\huangk14\OneDrive - Medtronic PLC\CZ Production - 文档\General\POWER BI 数据源 V2\30-MES导出数据\publish\MES_batch_report_latest.parquet, 行数: 107574
2025-11-21 13:50:33,918 - INFO - 数据量较大(107574行)，Excel文件只保存前100000行
2025-11-21 13:51:12,400 - INFO - 已保存Excel验证文件: C:\Users\huangk14\OneDrive - Medtronic PLC\CZ Production - 文档\General\POWER BI 数据源 V2\30-MES导出数据\publish\excel\MES_batch_report_latest.xlsx, 行数: 100000
2025-11-21 13:51:12,999 - INFO - ETL状态已更新: 总记录 107573, 新增 107573 条
2025-11-21 13:51:13,020 - INFO - 增量处理：已保存到latest文件并更新状态
2025-11-21 13:51:13,020 - INFO - 处理完成，耗时: 110.47秒
2025-11-21 14:02:49,495 - INFO - ============================================================
2025-11-21 14:02:49,504 - INFO - 用户选择: 全量刷新
2025-11-21 14:02:49,504 - INFO - ============================================================
2025-11-21 14:02:49,507 - INFO - 读取MES数据: C:\Users\huangk14\OneDrive - Medtronic PLC\CZ Production - 文档\General\POWER BI 数据源 V2\30-MES导出数据\Product Output -CZM -FY26.xlsx
2025-11-21 14:03:31,389 - INFO - 执行全量刷新：清除状态文件和历史数据文件
2025-11-21 14:03:31,393 - INFO - 已删除状态文件: C:\Users\huangk14\OneDrive - Medtronic PLC\CZ Production - 文档\General\POWER BI 数据源 V2\30-MES导出数据\publish\etl_mes_state.json
2025-11-21 14:03:31,399 - INFO - 已删除历史数据文件: C:\Users\huangk14\OneDrive - Medtronic PLC\CZ Production - 文档\General\POWER BI 数据源 V2\30-MES导出数据\publish\MES_batch_report_latest.parquet
2025-11-21 14:03:31,673 - INFO - 读取SFC数据: 20485 行
2025-11-21 14:03:31,868 - INFO - 合并SFC数据完成: 108114 行，匹配到Checkin_SFC: 16426 行
2025-11-21 14:03:31,887 - INFO - 使用标准时间表: SAP_Routing_latest.parquet
2025-11-21 14:03:31,928 - INFO - 读取合并后的标准时间表: 38293 行
2025-11-21 14:03:32,520 - INFO - 第一步Material Number匹配后，还有 32 条记录未匹配，尝试使用CFN匹配
2025-11-21 14:03:32,560 - INFO - 合并标准时间数据完成: 108121 行，总匹配成功: 108089 行
2025-11-21 14:03:32,560 - INFO - 匹配到EH_machine(s): 108089 行
2025-11-21 14:03:32,561 - INFO - 匹配到EH_labor(s): 108089 行
2025-11-21 14:03:32,562 - INFO - 匹配到OEE: 108121 行
2025-11-21 14:03:32,836 - INFO - 成功加载日历表: C:\Users\huangk14\OneDrive - Medtronic PLC\CZ Production - 文档\General\POWER BI 数据源 V2\30-MES导出数据\publish\日历工作日表.csv, 共1095条记录
2025-11-21 14:03:32,891 - INFO - 开始计算 PreviousBatchEndTime：有效machine记录 108121 条，总计 108121 条
2025-11-21 14:03:33,460 - INFO - 计算 PreviousBatchEndTime 完成：总计 108121 条，成功计算 108121 条（其中有效machine记录 108121 条）
2025-11-21 14:04:12,282 - INFO - MES数据字段筛选完成：保留 31 个字段
2025-11-21 14:04:12,293 - INFO - 历史数据文件不存在，直接使用新数据
2025-11-21 14:04:12,293 - INFO - 对所有合并后的数据统一计算 PreviousBatchEndTime
2025-11-21 14:04:12,309 - INFO - 开始计算 PreviousBatchEndTime：有效machine记录 108121 条，总计 108121 条
2025-11-21 14:04:12,687 - INFO - 计算 PreviousBatchEndTime 完成：总计 108121 条，成功计算 108121 条（其中有效machine记录 108121 条）
2025-11-21 14:04:12,736 - INFO - 已转换日期列 TrackOutDate 为datetime类型
2025-11-21 14:04:13,440 - INFO - 已保存Parquet文件: C:\Users\huangk14\OneDrive - Medtronic PLC\CZ Production - 文档\General\POWER BI 数据源 V2\30-MES导出数据\publish\MES_batch_report_latest.parquet, 行数: 108121
2025-11-21 14:04:13,482 - INFO - 数据量较大(108121行)，Excel文件只保存前100000行
2025-11-21 14:05:19,908 - INFO - 已保存Excel验证文件: C:\Users\huangk14\OneDrive - Medtronic PLC\CZ Production - 文档\General\POWER BI 数据源 V2\30-MES导出数据\publish\excel\MES_batch_report_latest.xlsx, 行数: 100000
2025-11-21 14:05:20,745 - INFO - ETL状态已更新: 总记录 107573, 新增 107573 条
2025-11-21 14:05:20,760 - INFO - 增量处理：已保存到latest文件并更新状态
2025-11-21 14:05:20,760 - INFO - 处理完成，耗时: 151.25秒
2025-11-21 14:09:32,554 - INFO - 开始创建增量数据分区...
2025-11-21 14:09:32,906 - INFO - 读取数据: 108121 行
2025-11-21 14:09:32,969 - INFO - 数据日期范围: 2025-04-01 至 2025-11-20
2025-11-21 14:09:33,071 - INFO - 创建分区 20250401: 709 行
2025-11-21 14:09:33,103 - INFO - 创建分区 20250402: 677 行
2025-11-21 14:09:33,139 - INFO - 创建分区 20250403: 658 行
2025-11-21 14:09:33,168 - INFO - 创建分区 20250404: 143 行
2025-11-21 14:09:33,200 - INFO - 创建分区 20250405: 303 行
2025-11-21 14:09:33,225 - INFO - 创建分区 20250406: 449 行
2025-11-21 14:09:33,257 - INFO - 创建分区 20250407: 668 行
2025-11-21 14:09:33,288 - INFO - 创建分区 20250408: 651 行
2025-11-21 14:09:33,317 - INFO - 创建分区 20250409: 640 行
2025-11-21 14:09:33,345 - INFO - 创建分区 20250410: 631 行
2025-11-21 14:09:33,379 - INFO - 创建分区 20250411: 613 行
2025-11-21 14:09:33,407 - INFO - 创建分区 20250412: 423 行
2025-11-21 14:09:33,436 - INFO - 创建分区 20250413: 272 行
2025-11-21 14:09:33,467 - INFO - 创建分区 20250414: 543 行
2025-11-21 14:09:33,497 - INFO - 创建分区 20250415: 650 行
2025-11-21 14:09:33,525 - INFO - 创建分区 20250416: 630 行
2025-11-21 14:09:33,561 - INFO - 创建分区 20250417: 636 行
2025-11-21 14:09:33,599 - INFO - 创建分区 20250418: 591 行
2025-11-21 14:09:33,636 - INFO - 创建分区 20250419: 551 行
2025-11-21 14:09:33,665 - INFO - 创建分区 20250420: 153 行
2025-11-21 14:09:33,697 - INFO - 创建分区 20250421: 621 行
2025-11-21 14:09:33,731 - INFO - 创建分区 20250422: 651 行
2025-11-21 14:09:33,762 - INFO - 创建分区 20250423: 619 行
2025-11-21 14:09:33,790 - INFO - 创建分区 20250424: 284 行
2025-11-21 14:09:33,813 - INFO - 创建分区 20250425: 112 行
2025-11-21 14:09:33,850 - INFO - 创建分区 20250426: 389 行
2025-11-21 14:09:33,891 - INFO - 创建分区 20250427: 653 行
2025-11-21 14:09:33,926 - INFO - 创建分区 20250428: 883 行
2025-11-21 14:09:33,959 - INFO - 创建分区 20250429: 648 行
2025-11-21 14:09:33,994 - INFO - 创建分区 20250430: 542 行
2025-11-21 14:09:34,022 - INFO - 创建分区 20250501: 14 行
2025-11-21 14:09:34,051 - INFO - 创建分区 20250505: 178 行
2025-11-21 14:09:34,090 - INFO - 创建分区 20250506: 592 行
2025-11-21 14:09:34,125 - INFO - 创建分区 20250507: 601 行
2025-11-21 14:09:34,157 - INFO - 创建分区 20250508: 639 行
2025-11-21 14:09:34,198 - INFO - 创建分区 20250509: 661 行
2025-11-21 14:09:34,231 - INFO - 创建分区 20250510: 506 行
2025-11-21 14:09:34,261 - INFO - 创建分区 20250511: 198 行
2025-11-21 14:09:34,295 - INFO - 创建分区 20250512: 548 行
2025-11-21 14:09:34,339 - INFO - 创建分区 20250513: 635 行
2025-11-21 14:09:34,373 - INFO - 创建分区 20250514: 611 行
2025-11-21 14:09:34,427 - INFO - 创建分区 20250515: 614 行
2025-11-21 14:09:34,469 - INFO - 创建分区 20250516: 556 行
2025-11-21 14:09:34,507 - INFO - 创建分区 20250517: 344 行
2025-11-21 14:09:34,545 - INFO - 创建分区 20250518: 38 行
2025-11-21 14:09:34,584 - INFO - 创建分区 20250519: 512 行
2025-11-21 14:09:34,630 - INFO - 创建分区 20250520: 568 行
2025-11-21 14:09:34,668 - INFO - 创建分区 20250521: 655 行
2025-11-21 14:09:34,710 - INFO - 创建分区 20250522: 625 行
2025-11-21 14:09:34,775 - INFO - 创建分区 20250523: 452 行
2025-11-21 14:09:34,837 - INFO - 创建分区 20250524: 530 行
2025-11-21 14:09:34,901 - INFO - 创建分区 20250525: 202 行
2025-11-21 14:09:34,957 - INFO - 创建分区 20250526: 20 行
2025-11-21 14:09:35,023 - INFO - 创建分区 20250527: 586 行
2025-11-21 14:09:35,066 - INFO - 创建分区 20250528: 654 行
2025-11-21 14:09:35,121 - INFO - 创建分区 20250529: 664 行
2025-11-21 14:09:35,204 - INFO - 创建分区 20250530: 612 行
2025-11-21 14:09:35,231 - INFO - 创建分区 20250531: 81 行
2025-11-21 14:09:35,276 - INFO - 创建分区 20250602: 487 行
2025-11-21 14:09:35,318 - INFO - 创建分区 20250603: 587 行
2025-11-21 14:09:35,356 - INFO - 创建分区 20250604: 591 行
2025-11-21 14:09:35,640 - INFO - 创建分区 20250605: 595 行
2025-11-21 14:09:35,805 - INFO - 创建分区 20250606: 612 行
2025-11-21 14:09:35,854 - INFO - 创建分区 20250607: 445 行
2025-11-21 14:09:35,940 - INFO - 创建分区 20250608: 266 行
2025-11-21 14:09:36,203 - INFO - 创建分区 20250609: 503 行
2025-11-21 14:09:36,412 - INFO - 创建分区 20250610: 585 行
2025-11-21 14:09:36,637 - INFO - 创建分区 20250611: 629 行
2025-11-21 14:09:37,101 - INFO - 创建分区 20250612: 618 行
2025-11-21 14:09:37,263 - INFO - 创建分区 20250613: 581 行
2025-11-21 14:09:37,531 - INFO - 创建分区 20250614: 493 行
2025-11-21 14:09:37,905 - INFO - 创建分区 20250615: 278 行
2025-11-21 14:09:38,032 - INFO - 创建分区 20250616: 510 行
2025-11-21 14:09:38,564 - INFO - 创建分区 20250617: 633 行
2025-11-21 14:09:38,764 - INFO - 创建分区 20250618: 634 行
2025-11-21 14:09:38,893 - INFO - 创建分区 20250619: 608 行
2025-11-21 14:09:39,133 - INFO - 创建分区 20250620: 619 行
2025-11-21 14:09:39,264 - INFO - 创建分区 20250621: 497 行
2025-11-21 14:09:39,392 - INFO - 创建分区 20250622: 137 行
2025-11-21 14:09:39,509 - INFO - 创建分区 20250623: 524 行
2025-11-21 14:09:39,739 - INFO - 创建分区 20250624: 613 行
2025-11-21 14:09:40,644 - INFO - 创建分区 20250625: 590 行
2025-11-21 14:09:40,887 - INFO - 创建分区 20250626: 566 行
2025-11-21 14:09:41,579 - INFO - 创建分区 20250627: 97 行
2025-11-21 14:09:41,778 - INFO - 创建分区 20250628: 463 行
2025-11-21 14:09:42,254 - INFO - 创建分区 20250629: 138 行
2025-11-21 14:09:42,422 - INFO - 创建分区 20250630: 244 行
2025-11-21 14:09:42,456 - INFO - 创建分区 20250701: 657 行
2025-11-21 14:09:42,747 - INFO - 创建分区 20250702: 637 行
2025-11-21 14:09:43,070 - INFO - 创建分区 20250703: 665 行
2025-11-21 14:09:43,627 - INFO - 创建分区 20250704: 625 行
2025-11-21 14:09:44,095 - INFO - 创建分区 20250705: 352 行
2025-11-21 14:09:44,306 - INFO - 创建分区 20250706: 49 行
2025-11-21 14:09:44,520 - INFO - 创建分区 20250707: 456 行
2025-11-21 14:09:44,755 - INFO - 创建分区 20250708: 619 行
2025-11-21 14:09:44,963 - INFO - 创建分区 20250709: 655 行
2025-11-21 14:09:45,379 - INFO - 创建分区 20250710: 658 行
2025-11-21 14:09:45,852 - INFO - 创建分区 20250711: 610 行
2025-11-21 14:09:46,068 - INFO - 创建分区 20250712: 522 行
2025-11-21 14:09:46,223 - INFO - 创建分区 20250713: 327 行
2025-11-21 14:09:46,311 - INFO - 创建分区 20250714: 564 行
2025-11-21 14:09:46,597 - INFO - 创建分区 20250715: 652 行
2025-11-21 14:09:46,833 - INFO - 创建分区 20250716: 685 行
2025-11-21 14:09:47,001 - INFO - 创建分区 20250717: 677 行
2025-11-21 14:09:47,273 - INFO - 创建分区 20250718: 667 行
2025-11-21 14:09:47,374 - INFO - 创建分区 20250719: 335 行
2025-11-21 14:09:47,494 - INFO - 创建分区 20250720: 37 行
2025-11-21 14:09:47,632 - INFO - 创建分区 20250721: 543 行
2025-11-21 14:09:47,961 - INFO - 创建分区 20250722: 654 行
2025-11-21 14:09:48,709 - INFO - 创建分区 20250723: 712 行
2025-11-21 14:09:48,833 - INFO - 创建分区 20250724: 674 行
2025-11-21 14:09:49,234 - INFO - 创建分区 20250725: 772 行
2025-11-21 14:09:49,713 - INFO - 创建分区 20250726: 376 行
2025-11-21 14:09:50,042 - INFO - 创建分区 20250727: 150 行
2025-11-21 14:09:50,343 - INFO - 创建分区 20250728: 671 行
2025-11-21 14:09:50,523 - INFO - 创建分区 20250729: 660 行
2025-11-21 14:09:50,663 - INFO - 创建分区 20250730: 512 行
2025-11-21 14:09:50,959 - INFO - 创建分区 20250731: 501 行
2025-11-21 14:09:51,087 - INFO - 创建分区 20250801: 657 行
2025-11-21 14:09:51,240 - INFO - 创建分区 20250802: 120 行
2025-11-21 14:09:51,346 - INFO - 创建分区 20250804: 535 行
2025-11-21 14:09:51,470 - INFO - 创建分区 20250805: 713 行
2025-11-21 14:09:51,598 - INFO - 创建分区 20250806: 680 行
2025-11-21 14:09:51,727 - INFO - 创建分区 20250807: 675 行
2025-11-21 14:09:51,853 - INFO - 创建分区 20250808: 704 行
2025-11-21 14:09:52,070 - INFO - 创建分区 20250809: 165 行
2025-11-21 14:09:52,251 - INFO - 创建分区 20250810: 15 行
2025-11-21 14:09:52,379 - INFO - 创建分区 20250811: 546 行
2025-11-21 14:09:52,481 - INFO - 创建分区 20250812: 690 行
2025-11-21 14:09:52,557 - INFO - 创建分区 20250813: 683 行
2025-11-21 14:09:52,736 - INFO - 创建分区 20250814: 690 行
2025-11-21 14:09:53,360 - INFO - 创建分区 20250815: 676 行
2025-11-21 14:09:53,647 - INFO - 创建分区 20250816: 253 行
2025-11-21 14:09:53,912 - INFO - 创建分区 20250817: 7 行
2025-11-21 14:09:54,004 - INFO - 创建分区 20250818: 512 行
2025-11-21 14:09:54,084 - INFO - 创建分区 20250819: 599 行
2025-11-21 14:09:54,140 - INFO - 创建分区 20250820: 661 行
2025-11-21 14:09:54,281 - INFO - 创建分区 20250821: 616 行
2025-11-21 14:09:54,513 - INFO - 创建分区 20250822: 600 行
2025-11-21 14:09:54,628 - INFO - 创建分区 20250823: 124 行
2025-11-21 14:09:54,724 - INFO - 创建分区 20250824: 14 行
2025-11-21 14:09:54,947 - INFO - 创建分区 20250825: 588 行
2025-11-21 14:09:55,082 - INFO - 创建分区 20250826: 649 行
2025-11-21 14:09:55,406 - INFO - 创建分区 20250827: 700 行
2025-11-21 14:09:55,754 - INFO - 创建分区 20250828: 679 行
2025-11-21 14:09:55,852 - INFO - 创建分区 20250829: 584 行
2025-11-21 14:09:56,422 - INFO - 创建分区 20250830: 109 行
2025-11-21 14:09:56,675 - INFO - 创建分区 20250831: 10 行
2025-11-21 14:09:56,863 - INFO - 创建分区 20250901: 519 行
2025-11-21 14:09:57,170 - INFO - 创建分区 20250902: 685 行
2025-11-21 14:09:57,424 - INFO - 创建分区 20250903: 580 行
2025-11-21 14:09:58,064 - INFO - 创建分区 20250904: 569 行
2025-11-21 14:09:58,163 - INFO - 创建分区 20250905: 511 行
2025-11-21 14:09:58,289 - INFO - 创建分区 20250906: 85 行
2025-11-21 14:09:58,405 - INFO - 创建分区 20250907: 10 行
2025-11-21 14:09:58,649 - INFO - 创建分区 20250908: 490 行
2025-11-21 14:09:58,864 - INFO - 创建分区 20250909: 595 行
2025-11-21 14:09:59,007 - INFO - 创建分区 20250910: 617 行
2025-11-21 14:09:59,104 - INFO - 创建分区 20250911: 599 行
2025-11-21 14:09:59,344 - INFO - 创建分区 20250912: 623 行
2025-11-21 14:09:59,487 - INFO - 创建分区 20250913: 78 行
2025-11-21 14:09:59,885 - INFO - 创建分区 20250914: 2 行
2025-11-21 14:10:00,027 - INFO - 创建分区 20250915: 484 行
2025-11-21 14:10:00,176 - INFO - 创建分区 20250916: 579 行
2025-11-21 14:10:00,378 - INFO - 创建分区 20250917: 605 行
2025-11-21 14:10:00,529 - INFO - 创建分区 20250918: 591 行
2025-11-21 14:10:00,640 - INFO - 创建分区 20250919: 576 行
2025-11-21 14:10:00,782 - INFO - 创建分区 20250920: 82 行
2025-11-21 14:10:00,845 - INFO - 创建分区 20250921: 5 行
2025-11-21 14:10:00,941 - INFO - 创建分区 20250922: 438 行
2025-11-21 14:10:01,059 - INFO - 创建分区 20250923: 573 行
2025-11-21 14:10:01,237 - INFO - 创建分区 20250924: 580 行
2025-11-21 14:10:01,398 - INFO - 创建分区 20250925: 651 行
2025-11-21 14:10:01,583 - INFO - 创建分区 20250926: 684 行
2025-11-21 14:10:01,708 - INFO - 创建分区 20250927: 108 行
2025-11-21 14:10:01,862 - INFO - 创建分区 20250928: 494 行
2025-11-21 14:10:02,181 - INFO - 创建分区 20250929: 632 行
2025-11-21 14:10:02,320 - INFO - 创建分区 20250930: 503 行
2025-11-21 14:10:02,442 - INFO - 创建分区 20251001: 20 行
2025-11-21 14:10:02,592 - INFO - 创建分区 20251007: 2 行
2025-11-21 14:10:02,758 - INFO - 创建分区 20251008: 41 行
2025-11-21 14:10:03,127 - INFO - 创建分区 20251009: 482 行
2025-11-21 14:10:03,399 - INFO - 创建分区 20251010: 645 行
2025-11-21 14:10:03,758 - INFO - 创建分区 20251011: 614 行
2025-11-21 14:10:04,180 - INFO - 创建分区 20251012: 108 行
2025-11-21 14:10:04,357 - INFO - 创建分区 20251013: 475 行
2025-11-21 14:10:04,614 - INFO - 创建分区 20251014: 580 行
2025-11-21 14:10:05,020 - INFO - 创建分区 20251015: 584 行
2025-11-21 14:10:05,135 - INFO - 创建分区 20251016: 571 行
2025-11-21 14:10:05,477 - INFO - 创建分区 20251017: 596 行
2025-11-21 14:10:05,661 - INFO - 创建分区 20251018: 147 行
2025-11-21 14:10:05,884 - INFO - 创建分区 20251019: 38 行
2025-11-21 14:10:06,105 - INFO - 创建分区 20251020: 498 行
2025-11-21 14:10:06,449 - INFO - 创建分区 20251021: 572 行
2025-11-21 14:10:06,678 - INFO - 创建分区 20251022: 605 行
2025-11-21 14:10:06,723 - INFO - 创建分区 20251023: 599 行
2025-11-21 14:10:06,856 - INFO - 创建分区 20251024: 685 行
2025-11-21 14:10:07,027 - INFO - 创建分区 20251025: 83 行
2025-11-21 14:10:07,156 - INFO - 创建分区 20251026: 69 行
2025-11-21 14:10:07,695 - INFO - 创建分区 20251027: 445 行
2025-11-21 14:10:07,879 - INFO - 创建分区 20251028: 614 行
2025-11-21 14:10:07,991 - INFO - 创建分区 20251029: 592 行
2025-11-21 14:10:08,234 - INFO - 创建分区 20251030: 612 行
2025-11-21 14:10:08,481 - INFO - 创建分区 20251031: 597 行
2025-11-21 14:10:08,611 - INFO - 创建分区 20251101: 164 行
2025-11-21 14:10:08,741 - INFO - 创建分区 20251102: 78 行
2025-11-21 14:10:08,827 - INFO - 创建分区 20251103: 567 行
2025-11-21 14:10:08,861 - INFO - 创建分区 20251104: 640 行
2025-11-21 14:10:08,932 - INFO - 创建分区 20251105: 637 行
2025-11-21 14:10:09,073 - INFO - 创建分区 20251106: 649 行
2025-11-21 14:10:09,165 - INFO - 创建分区 20251107: 621 行
2025-11-21 14:10:09,396 - INFO - 创建分区 20251108: 190 行
2025-11-21 14:10:09,743 - INFO - 创建分区 20251109: 95 行
2025-11-21 14:10:10,240 - INFO - 创建分区 20251110: 571 行
2025-11-21 14:10:10,458 - INFO - 创建分区 20251111: 626 行
2025-11-21 14:10:10,643 - INFO - 创建分区 20251112: 655 行
2025-11-21 14:10:10,813 - INFO - 创建分区 20251113: 665 行
2025-11-21 14:10:11,146 - INFO - 创建分区 20251114: 620 行
2025-11-21 14:10:11,483 - INFO - 创建分区 20251115: 487 行
2025-11-21 14:10:11,792 - INFO - 创建分区 20251116: 120 行
2025-11-21 14:10:12,310 - INFO - 创建分区 20251117: 528 行
2025-11-21 14:10:12,610 - INFO - 创建分区 20251118: 616 行
2025-11-21 14:10:12,802 - INFO - 创建分区 20251119: 604 行
2025-11-21 14:10:12,994 - INFO - 创建分区 20251120: 606 行
2025-11-21 14:10:13,015 - INFO - 分区创建完成: 224 个分区文件
2025-11-21 14:10:13,022 - INFO - 分区元数据保存至: C:\Users\huangk14\OneDrive - Medtronic PLC\CZ Production - 文档\General\POWER BI 数据源 V2\30-MES导出数据\publish\partitions\partition_metadata.json
2025-11-21 14:10:13,032 - INFO - PowerBI M脚本保存至: C:\Users\huangk14\OneDrive - Medtronic PLC\CZ Production - 文档\General\POWER BI 数据源 V2\30-MES导出数据\publish\partitions\PowerBI_Incremental_Query.m
2025-11-21 14:10:13,139 - INFO - 使用说明保存至: C:\Users\huangk14\OneDrive - Medtronic PLC\CZ Production - 文档\General\POWER BI 数据源 V2\30-MES导出数据\publish\partitions\README.md
2025-11-24 08:56:22,898 - INFO - ============================================================
2025-11-24 08:56:22,902 - INFO - 用户选择: 增量刷新
2025-11-24 08:56:22,904 - INFO - ============================================================
2025-11-24 08:56:22,905 - ERROR - MES数据路径未配置
2025-11-24 08:56:22,909 - WARNING - MES处理后的数据为空，跳过保存
2025-11-24 08:57:59,498 - INFO - ============================================================
2025-11-24 08:57:59,499 - INFO - 用户选择: 增量刷新
2025-11-24 08:57:59,499 - INFO - ============================================================
2025-11-24 08:57:59,499 - INFO - 使用多工厂数据源配置，共 2 个工厂
2025-11-24 08:57:59,500 - INFO - 开始读取多工厂数据...
2025-11-24 08:57:59,500 - INFO - 开始读取 2 个工厂数据...
2025-11-24 08:57:59,500 - INFO - 正在读取 工厂1-CZM 数据...
2025-11-24 08:59:04,088 - INFO - ✅ 工厂1-CZM: 成功读取 118640 行数据
2025-11-24 08:59:04,091 - INFO - 正在读取 工厂2-CKH 数据...
2025-11-24 08:59:57,606 - INFO - ✅ 工厂2-CKH: 成功读取 150003 行数据
2025-11-24 08:59:57,788 - INFO - ✅ 多工厂数据合并完成: 总计 268643 行数据
2025-11-24 08:59:57,859 - INFO - 各工厂数据量: {'CKH': 150003, 'CZM': 118640}
2025-11-24 08:59:57,923 - INFO - 数据包含 2 个工厂
2025-11-24 08:59:57,931 - INFO - 多工厂数据验证通过: 268643 条记录
2025-11-24 08:59:58,119 - INFO - 多工厂数据摘要: 总计 268643 条记录，包含 2 个工厂
2025-11-24 08:59:58,122 - INFO -   CZM (工厂1-CZM): 118640 条记录
2025-11-24 08:59:58,124 - INFO -   CKH (工厂2-CKH): 150003 条记录
2025-11-24 08:59:58,126 - WARNING - 去重关键字段不存在，跳过去重: ['BatchNumber', 'Operation', 'machine']
2025-11-24 09:00:04,379 - INFO - 未找到上次处理时间，执行全量刷新
2025-11-24 09:00:04,382 - INFO - 执行全量刷新：清除状态文件
2025-11-24 09:00:04,914 - INFO - 读取SFC数据: 20485 行
2025-11-24 09:00:05,084 - INFO - 合并SFC数据完成: 169605 行，匹配到Checkin_SFC: 16442 行
2025-11-24 09:00:05,107 - INFO - 使用标准时间表: SAP_Routing_latest.parquet
2025-11-24 09:00:05,131 - INFO - 读取合并后的标准时间表: 38293 行
2025-11-24 09:00:05,981 - INFO - 第一步Material Number匹配后，还有 60632 条记录未匹配，尝试使用CFN匹配
2025-11-24 09:00:06,330 - INFO - 合并标准时间数据完成: 169612 行，总匹配成功: 108980 行
2025-11-24 09:00:06,333 - INFO - 匹配到EH_machine(s): 108980 行
2025-11-24 09:00:06,335 - INFO - 匹配到EH_labor(s): 108980 行
2025-11-24 09:00:06,338 - INFO - 匹配到OEE: 169612 行
2025-11-24 09:00:06,586 - INFO - 成功加载日历表: C:\Users\huangk14\OneDrive - Medtronic PLC\CZ Production - 文档\General\POWER BI 数据源 V2\30-MES导出数据\publish\日历工作日表.csv, 共1095条记录
2025-11-24 09:00:06,663 - INFO - 开始计算 PreviousBatchEndTime：有效machine记录 169612 条，总计 169612 条
2025-11-24 09:00:07,259 - INFO - 计算 PreviousBatchEndTime 完成：总计 169612 条，成功计算 169612 条（其中有效machine记录 169612 条）
2025-11-24 09:00:39,799 - INFO - MES数据字段筛选完成：保留 33 个字段
2025-11-24 09:00:39,955 - INFO - 加载历史数据: 108121 行
2025-11-24 09:00:40,434 - INFO - 数据合并完成：历史 108121 行 + 新增 169612 行 = 合并后 169046 行
2025-11-24 09:00:40,452 - INFO - 对所有合并后的数据统一计算 PreviousBatchEndTime
2025-11-24 09:00:40,515 - INFO - 开始计算 PreviousBatchEndTime：有效machine记录 169046 条，总计 169046 条
2025-11-24 09:00:41,111 - INFO - 计算 PreviousBatchEndTime 完成：总计 169046 条，成功计算 169046 条（其中有效machine记录 169046 条）
2025-11-24 09:00:41,188 - INFO - 已转换日期列 TrackOutDate 为datetime类型
2025-11-24 09:00:42,137 - INFO - 已保存Parquet文件: C:\Users\huangk14\OneDrive - Medtronic PLC\CZ Production - 文档\General\POWER BI 数据源 V2\30-MES导出数据\publish\MES_batch_report_latest.parquet, 行数: 169046
2025-11-24 09:01:59,786 - INFO - 已保存Excel验证文件: C:\Users\huangk14\OneDrive - Medtronic PLC\CZ Production - 文档\General\POWER BI 数据源 V2\30-MES导出数据\publish\excel\MES_batch_report_latest.xlsx, 行数: 169046
2025-11-24 09:02:02,046 - INFO - ETL状态已更新: 总记录 169046, 新增 169046 条
2025-11-24 09:02:02,081 - INFO - 增量处理：已保存到latest文件并更新状态
2025-11-24 09:02:02,082 - INFO - 处理完成，耗时: 242.58秒
2025-11-24 12:23:53,793 - INFO - ============================================================
2025-11-24 12:23:53,796 - INFO - 用户选择: 全量刷新
2025-11-24 12:23:53,798 - INFO - ============================================================
2025-11-24 12:23:53,799 - INFO - 使用多工厂数据源配置，共 2 个工厂
2025-11-24 12:23:53,800 - INFO - 开始读取多工厂数据...
2025-11-24 12:23:53,802 - INFO - 开始读取 2 个工厂数据...
2025-11-24 12:23:53,803 - INFO - 正在读取 工厂1-CZM 数据...
2025-11-24 12:24:39,411 - INFO - ✅ 工厂1-CZM: 成功读取 118640 行数据
2025-11-24 12:24:39,412 - INFO - 正在读取 工厂2-CKH 数据...
2025-11-24 12:25:37,057 - INFO - ✅ 工厂2-CKH: 成功读取 150003 行数据
2025-11-24 12:25:37,257 - INFO - ✅ 多工厂数据合并完成: 总计 268643 行数据
2025-11-24 12:25:37,284 - INFO - 各工厂数据量: {'CKH': 150003, 'CZM': 118640}
2025-11-24 12:25:37,310 - INFO - 数据包含 2 个工厂
2025-11-24 12:25:37,318 - INFO - 多工厂数据验证通过: 268643 条记录
2025-11-24 12:25:37,431 - INFO - 多工厂数据摘要: 总计 268643 条记录，包含 2 个工厂
2025-11-24 12:25:37,432 - INFO -   CZM (工厂1-CZM): 118640 条记录
2025-11-24 12:25:37,434 - INFO -   CKH (工厂2-CKH): 150003 条记录
2025-11-24 12:25:43,307 - INFO - 去重完成：移除 27 条重复记录（基于字段: ['BatchNumber', 'Operation', 'machine', 'factory_source']，排序字段: TrackOutTime）
2025-11-24 12:25:43,308 - INFO - 去重前: 169047 行，去重后: 169020 行
2025-11-24 12:25:43,351 - INFO - 执行全量刷新：清除状态文件和历史数据文件
2025-11-24 12:25:43,355 - INFO - 已删除状态文件: C:\Users\huangk14\OneDrive - Medtronic PLC\CZ Production - 文档\General\POWER BI 数据源 V2\30-MES导出数据\publish\etl_mes_state.json
2025-11-24 12:25:43,366 - INFO - 已删除历史数据文件: C:\Users\huangk14\OneDrive - Medtronic PLC\CZ Production - 文档\General\POWER BI 数据源 V2\30-MES导出数据\publish\MES_batch_report_latest.parquet
2025-11-24 12:25:43,628 - INFO - 读取SFC数据: 20485 行
2025-11-24 12:25:43,787 - INFO - 合并SFC数据完成: 169578 行，匹配到Checkin_SFC: 16439 行
2025-11-24 12:25:43,813 - INFO - 使用标准时间表: SAP_Routing_latest.parquet
2025-11-24 12:25:44,008 - INFO - 读取合并后的标准时间表: 332430 行
2025-11-24 12:25:45,052 - INFO - 第一步Material Number匹配后，还有 5920 条记录未匹配，尝试使用CFN匹配
2025-11-24 12:25:45,315 - INFO - 合并标准时间数据完成: 171051 行，总匹配成功: 165131 行
2025-11-24 12:25:45,316 - INFO - 匹配到EH_machine(s): 165131 行
2025-11-24 12:25:45,317 - INFO - 匹配到EH_labor(s): 165131 行
2025-11-24 12:25:45,318 - INFO - 匹配到OEE: 171051 行
2025-11-24 12:25:45,515 - INFO - 成功加载日历表: C:\Users\huangk14\OneDrive - Medtronic PLC\CZ Production - 文档\General\POWER BI 数据源 V2\30-MES导出数据\publish\日历工作日表.csv, 共1095条记录
2025-11-24 12:25:45,559 - INFO - 开始计算 PreviousBatchEndTime：有效machine记录 171051 条，总计 171051 条
2025-11-24 12:25:46,210 - INFO - 计算 PreviousBatchEndTime 完成：总计 171051 条，成功计算 171051 条（其中有效machine记录 171051 条）
2025-11-24 12:26:22,446 - INFO - MES数据字段筛选完成：保留 33 个字段
2025-11-24 12:26:22,477 - INFO - 对所有合并后的数据统一计算 PreviousBatchEndTime
2025-11-24 12:26:22,529 - INFO - 开始计算 PreviousBatchEndTime：有效machine记录 171051 条，总计 171051 条
2025-11-24 12:26:23,003 - INFO - 计算 PreviousBatchEndTime 完成：总计 171051 条，成功计算 171051 条（其中有效machine记录 171051 条）
2025-11-24 12:26:23,077 - INFO - 已转换日期列 TrackOutDate 为datetime类型
2025-11-24 12:26:24,080 - INFO - 已保存Parquet文件: C:\Users\huangk14\OneDrive - Medtronic PLC\CZ Production - 文档\General\POWER BI 数据源 V2\30-MES导出数据\publish\MES_batch_report_latest.parquet, 行数: 171051
2025-11-24 12:27:38,958 - INFO - 已保存Excel验证文件: C:\Users\huangk14\OneDrive - Medtronic PLC\CZ Production - 文档\General\POWER BI 数据源 V2\30-MES导出数据\publish\excel\MES_batch_report_latest.xlsx, 行数: 171051
2025-11-24 12:27:38,978 - INFO - MES数据已保存: C:\Users\huangk14\OneDrive - Medtronic PLC\CZ Production - 文档\General\POWER BI 数据源 V2\30-MES导出数据\publish\MES_batch_report_latest.parquet
2025-11-24 12:27:38,979 - INFO - 处理完成，耗时: 225.18秒
2025-11-24 13:26:46,529 - INFO - ============================================================
2025-11-24 13:26:46,530 - INFO - 用户选择: 全量刷新
2025-11-24 13:26:46,530 - INFO - ============================================================
2025-11-24 13:26:46,531 - INFO - 使用多工厂数据源配置，共 2 个工厂
2025-11-24 13:26:46,531 - INFO - 开始读取多工厂数据...
2025-11-24 13:26:46,531 - INFO - 开始读取 2 个工厂数据...
2025-11-24 13:26:46,532 - INFO - 正在读取 工厂1-CZM 数据...
2025-11-24 13:27:35,475 - INFO - ✅ 工厂1-CZM: 成功读取 118640 行数据
2025-11-24 13:27:35,477 - INFO - 正在读取 工厂2-CKH 数据...
2025-11-24 13:29:19,417 - INFO - ✅ 工厂2-CKH: 成功读取 150003 行数据
2025-11-24 13:29:19,659 - INFO - ✅ 多工厂数据合并完成: 总计 268643 行数据
2025-11-24 13:29:19,678 - INFO - 各工厂数据量: {'CKH': 150003, 'CZM': 118640}
2025-11-24 13:29:19,723 - INFO - 数据包含 2 个工厂
2025-11-24 13:29:19,731 - INFO - 多工厂数据验证通过: 268643 条记录
2025-11-24 13:29:19,948 - INFO - 多工厂数据摘要: 总计 268643 条记录，包含 2 个工厂
2025-11-24 13:29:19,949 - INFO -   CZM (工厂1-CZM): 118640 条记录
2025-11-24 13:29:19,950 - INFO -   CKH (工厂2-CKH): 150003 条记录
2025-11-24 13:29:33,887 - INFO - 去重完成：移除 27 条重复记录（基于字段: ['BatchNumber', 'Operation', 'machine', 'factory_source']，排序字段: TrackOutTime）
2025-11-24 13:29:33,889 - INFO - 去重前: 169047 行，去重后: 169020 行
2025-11-24 13:29:33,943 - INFO - 执行全量刷新：清除状态文件和历史数据文件
2025-11-24 13:29:33,947 - INFO - 已删除历史数据文件: C:\Users\huangk14\OneDrive - Medtronic PLC\CZ Production - 文档\General\POWER BI 数据源 V2\30-MES导出数据\publish\MES_batch_report_latest.parquet
2025-11-24 13:29:34,408 - INFO - 读取SFC数据: 20485 行
2025-11-24 13:29:34,708 - INFO - 合并SFC数据完成: 169578 行，匹配到Checkin_SFC: 16439 行
2025-11-24 13:29:34,739 - INFO - 使用标准时间表: SAP_Routing_latest.parquet
2025-11-24 13:29:34,954 - INFO - 读取合并后的标准时间表: 332430 行
2025-11-24 13:29:36,306 - INFO - 第一步Material Number匹配后，还有 5920 条记录未匹配，尝试使用CFN匹配
2025-11-24 13:29:36,712 - INFO - 合并标准时间数据完成: 171051 行，总匹配成功: 165131 行
2025-11-24 13:29:36,713 - INFO - 匹配到EH_machine(s): 165131 行
2025-11-24 13:29:36,715 - INFO - 匹配到EH_labor(s): 165131 行
2025-11-24 13:29:36,718 - INFO - 匹配到OEE: 171051 行
2025-11-24 13:29:37,101 - INFO - 成功加载日历表: C:\Users\huangk14\OneDrive - Medtronic PLC\CZ Production - 文档\General\POWER BI 数据源 V2\30-MES导出数据\publish\日历工作日表.csv, 共1095条记录
2025-11-24 13:29:37,192 - INFO - 开始计算 PreviousBatchEndTime：有效machine记录 171051 条，总计 171051 条
2025-11-24 13:29:38,097 - INFO - 计算 PreviousBatchEndTime 完成：总计 171051 条，成功计算 171051 条（其中有效machine记录 171051 条）
2025-11-24 13:31:15,268 - INFO - MES数据字段筛选完成：保留 33 个字段
2025-11-24 13:31:15,332 - INFO - 历史数据文件不存在，直接使用新数据
2025-11-24 13:31:15,335 - INFO - 对所有合并后的数据统一计算 PreviousBatchEndTime
2025-11-24 13:31:15,419 - INFO - 开始计算 PreviousBatchEndTime：有效machine记录 171051 条，总计 171051 条
2025-11-24 13:31:16,226 - INFO - 计算 PreviousBatchEndTime 完成：总计 171051 条，成功计算 171051 条（其中有效machine记录 171051 条）
2025-11-24 13:31:16,320 - INFO - 已转换日期列 TrackOutDate 为datetime类型
2025-11-24 13:31:18,251 - INFO - 已保存Parquet文件: C:\Users\huangk14\OneDrive - Medtronic PLC\CZ Production - 文档\General\POWER BI 数据源 V2\30-MES导出数据\publish\MES_batch_report_latest.parquet, 行数: 171051
2025-11-24 13:34:36,709 - INFO - 已保存Excel验证文件: C:\Users\huangk14\OneDrive - Medtronic PLC\CZ Production - 文档\General\POWER BI 数据源 V2\30-MES导出数据\publish\excel\MES_batch_report_latest.xlsx, 行数: 171051
2025-11-24 13:34:38,864 - INFO - ETL状态已更新: 总记录 169020, 新增 169020 条
2025-11-24 13:34:38,899 - INFO - 增量处理：已保存到latest文件并更新状态
2025-11-24 13:34:38,900 - INFO - 处理完成，耗时: 472.37秒
2025-11-25 09:52:46,807 - INFO - ============================================================
2025-11-25 09:52:46,809 - INFO - 用户选择: 增量刷新
2025-11-25 09:52:46,810 - INFO - ============================================================
2025-11-25 09:52:46,810 - INFO - 使用多工厂数据源配置，共 2 个工厂
2025-11-25 09:52:46,811 - INFO - 开始读取多工厂数据...
2025-11-25 09:52:46,811 - INFO - 开始读取 2 个工厂数据...
2025-11-25 09:52:46,813 - INFO - 正在读取 工厂1-CZM 数据...
2025-11-25 09:54:20,133 - INFO - ✅ 工厂1-CZM: 成功读取 119291 行数据
2025-11-25 09:54:20,134 - INFO - 正在读取 工厂2-CKH 数据...
2025-11-25 09:55:38,647 - INFO - ✅ 工厂2-CKH: 成功读取 126486 行数据
2025-11-25 09:55:38,695 - INFO - ✅ 多工厂数据合并完成: 总计 245777 行数据
2025-11-25 09:55:38,713 - INFO - 各工厂数据量: {'CKH': 126486, 'CZM': 119291}
2025-11-25 09:55:38,719 - INFO - 数据包含 2 个工厂
2025-11-25 09:55:38,743 - INFO - 多工厂数据验证通过: 245777 条记录
2025-11-25 09:55:38,893 - INFO - 多工厂数据摘要: 总计 245777 条记录，包含 2 个工厂
2025-11-25 09:55:38,894 - INFO -   CZM (工厂1-CZM): 119291 条记录
2025-11-25 09:55:38,895 - INFO -   CKH (工厂2-CKH): 126486 条记录
2025-11-25 09:55:47,471 - INFO - 去重完成：移除 40 条重复记录（基于字段: ['BatchNumber', 'Operation', 'machine', 'factory_source']，排序字段: TrackOutTime）
2025-11-25 09:55:47,472 - INFO - 去重前: 163979 行，去重后: 163939 行
2025-11-25 09:55:47,521 - INFO - 未找到上次处理时间，执行全量刷新
2025-11-25 09:55:47,524 - INFO - 执行全量刷新：清除状态文件
2025-11-25 09:55:48,301 - INFO - 读取SFC数据: 20485 行
2025-11-25 09:55:48,480 - INFO - 合并SFC数据完成: 164499 行，匹配到Checkin_SFC: 16443 行
2025-11-25 09:55:48,482 - INFO - 使用标准时间表: SAP_Routing_latest.parquet
2025-11-25 09:55:48,685 - INFO - 读取合并后的标准时间表: 332430 行
2025-11-25 09:55:49,670 - INFO - 第一步Material Number匹配后，还有 266 条记录未匹配，尝试使用CFN匹配
2025-11-25 09:55:49,942 - INFO - 合并标准时间数据完成: 167516 行，总匹配成功: 167250 行
2025-11-25 09:55:49,943 - INFO - 匹配到EH_machine(s): 167250 行
2025-11-25 09:55:49,943 - INFO - 匹配到EH_labor(s): 167250 行
2025-11-25 09:55:49,944 - INFO - 匹配到OEE: 167516 行
2025-11-25 09:55:50,139 - INFO - 成功加载日历表: C:\Users\huangk14\OneDrive - Medtronic PLC\CZ Production - 文档\General\POWER BI 数据源 V2\30-MES导出数据\publish\日历工作日表.csv, 共1095条记录
2025-11-25 09:55:50,186 - INFO - 开始计算 PreviousBatchEndTime：有效machine记录 167516 条，总计 167516 条
2025-11-25 09:55:50,666 - INFO - 计算 PreviousBatchEndTime 完成：总计 167516 条，成功计算 167516 条（其中有效machine记录 167516 条）
2025-11-25 09:57:38,051 - INFO - MES数据字段筛选完成：保留 33 个字段
2025-11-25 09:57:38,281 - INFO - 加载历史数据: 171051 行
2025-11-25 09:57:39,099 - INFO - 数据合并完成：历史 171051 行 + 新增 167516 行 = 合并后 224531 行
2025-11-25 09:57:39,099 - INFO - 对所有合并后的数据统一计算 PreviousBatchEndTime
2025-11-25 09:57:39,275 - INFO - 开始计算 PreviousBatchEndTime：有效machine记录 224531 条，总计 224531 条
2025-11-25 09:57:40,603 - INFO - 计算 PreviousBatchEndTime 完成：总计 224531 条，成功计算 224531 条（其中有效machine记录 224531 条）
2025-11-25 09:57:40,827 - INFO - 已转换日期列 TrackOutDate 为datetime类型
2025-11-25 09:57:42,649 - INFO - 已保存Parquet文件: C:\Users\huangk14\OneDrive - Medtronic PLC\CZ Production - 文档\General\POWER BI 数据源 V2\30-MES导出数据\publish\MES_batch_report_latest.parquet, 行数: 224531
2025-11-25 09:57:42,758 - INFO - 数据量较大(224531行)，Excel文件只保存前200000行
2025-11-25 10:01:43,799 - INFO - 已保存Excel验证文件: C:\Users\huangk14\OneDrive - Medtronic PLC\CZ Production - 文档\General\POWER BI 数据源 V2\30-MES导出数据\publish\excel\MES_batch_report_latest.xlsx, 行数: 200000
2025-11-25 10:01:47,285 - INFO - ETL状态已更新: 总记录 224531, 新增 224531 条
2025-11-25 10:01:47,286 - INFO - 增量处理：已保存到latest文件并更新状态
2025-11-25 10:01:47,286 - INFO - 处理完成，耗时: 540.48秒
2025-11-26 08:22:31,686 - INFO - ============================================================
2025-11-26 08:22:31,688 - INFO - 用户选择: 增量刷新
2025-11-26 08:22:31,690 - INFO - ============================================================
2025-11-26 08:22:31,691 - INFO - 使用多工厂数据源配置，共 2 个工厂
2025-11-26 08:22:31,693 - INFO - 开始读取多工厂数据...
2025-11-26 08:22:31,694 - INFO - 开始读取 2 个工厂数据...
2025-11-26 08:22:31,694 - INFO - 正在读取 工厂1-CZM 数据...
2025-11-26 08:23:33,327 - INFO - ✅ 工厂1-CZM: 成功读取 119291 行数据
2025-11-26 08:23:33,327 - INFO - 正在读取 工厂2-CKH 数据...
2025-11-26 08:24:34,317 - INFO - ✅ 工厂2-CKH: 成功读取 126486 行数据
2025-11-26 08:24:34,376 - INFO - ✅ 多工厂数据合并完成: 总计 245777 行数据
2025-11-26 08:24:34,398 - INFO - 各工厂数据量: {'CKH': 126486, 'CZM': 119291}
2025-11-26 08:24:34,406 - INFO - 数据包含 2 个工厂
2025-11-26 08:24:34,440 - INFO - 多工厂数据验证通过: 245777 条记录
2025-11-26 08:24:34,555 - INFO - 多工厂数据摘要: 总计 245777 条记录，包含 2 个工厂
2025-11-26 08:24:34,555 - INFO -   CZM (工厂1-CZM): 119291 条记录
2025-11-26 08:24:34,555 - INFO -   CKH (工厂2-CKH): 126486 条记录
2025-11-26 08:24:44,804 - INFO - 去重完成：移除 40 条重复记录（基于字段: ['BatchNumber', 'Operation', 'machine', 'factory_source']，排序字段: TrackOutTime）
2025-11-26 08:24:44,804 - INFO - 去重前: 163979 行，去重后: 163939 行
2025-11-26 08:24:44,901 - INFO - 未找到上次处理时间，执行全量刷新
2025-11-26 08:24:44,906 - INFO - 执行全量刷新：清除状态文件
2025-11-26 08:24:45,702 - INFO - 读取SFC数据: 20485 行
2025-11-26 08:24:45,899 - INFO - 合并SFC数据完成: 164499 行，匹配到Checkin_SFC: 16443 行
2025-11-26 08:24:45,903 - INFO - 使用标准时间表: SAP_Routing_latest.parquet
2025-11-26 08:24:46,129 - INFO - 读取合并后的标准时间表: 332430 行
2025-11-26 08:24:47,508 - INFO - 第一步Material Number匹配后，还有 266 条记录未匹配，尝试使用CFN匹配
2025-11-26 08:24:47,953 - INFO - 合并标准时间数据完成: 167516 行，总匹配成功: 167250 行
2025-11-26 08:24:47,956 - INFO - 匹配到EH_machine(s): 167250 行
2025-11-26 08:24:47,957 - INFO - 匹配到EH_labor(s): 167250 行
2025-11-26 08:24:47,958 - INFO - 匹配到OEE: 167516 行
2025-11-26 08:24:48,311 - INFO - 成功加载日历表: C:\Users\huangk14\OneDrive - Medtronic PLC\CZ Production - 文档\General\POWER BI 数据源 V2\30-MES导出数据\publish\日历工作日表.csv, 共1095条记录
2025-11-26 08:24:48,389 - INFO - 开始计算 PreviousBatchEndTime：有效machine记录 167516 条，总计 167516 条
2025-11-26 08:24:49,057 - INFO - 计算 PreviousBatchEndTime 完成：总计 167516 条，成功计算 167516 条（其中有效machine记录 167516 条）
2025-11-26 08:27:30,329 - INFO - MES数据字段筛选完成：保留 33 个字段
2025-11-26 08:27:30,580 - INFO - 加载历史数据: 224531 行
2025-11-26 08:27:31,542 - INFO - 数据合并完成：历史 224531 行 + 新增 167516 行 = 合并后 224531 行
2025-11-26 08:27:31,543 - INFO - 对所有合并后的数据统一计算 PreviousBatchEndTime
2025-11-26 08:27:31,654 - INFO - 开始计算 PreviousBatchEndTime：有效machine记录 224531 条，总计 224531 条
2025-11-26 08:27:32,406 - INFO - 计算 PreviousBatchEndTime 完成：总计 224531 条，成功计算 224531 条（其中有效machine记录 224531 条）
2025-11-26 08:27:32,557 - INFO - 已转换日期列 TrackOutDate 为datetime类型
2025-11-26 08:27:34,257 - INFO - 已保存Parquet文件: C:\Users\huangk14\OneDrive - Medtronic PLC\CZ Production - 文档\General\POWER BI 数据源 V2\30-MES导出数据\publish\MES_batch_report_latest.parquet, 行数: 224531
2025-11-26 08:27:34,480 - INFO - 数据量较大(224531行)，Excel文件只保存前200000行
2025-11-26 08:32:16,121 - INFO - 已保存Excel验证文件: C:\Users\huangk14\OneDrive - Medtronic PLC\CZ Production - 文档\General\POWER BI 数据源 V2\30-MES导出数据\publish\excel\MES_batch_report_latest.xlsx, 行数: 200000
2025-11-26 08:32:20,475 - INFO - ETL状态已更新: 总记录 224531, 新增 224531 条
2025-11-26 08:32:20,477 - INFO - 增量处理：已保存到latest文件并更新状态
2025-11-26 08:32:20,479 - INFO - 处理完成，耗时: 588.79秒
2025-11-26 09:43:20,029 - INFO - ============================================================
2025-11-26 09:43:20,032 - INFO - 无人值守模式启动
2025-11-26 09:43:20,032 - INFO - 刷新模式: 增量刷新
2025-11-26 09:43:20,033 - INFO - ============================================================
2025-11-26 09:43:20,035 - INFO - ============================================================
2025-11-26 09:43:20,035 - INFO - 用户选择: 增量刷新
2025-11-26 09:43:20,035 - INFO - ============================================================
2025-11-26 09:43:20,036 - INFO - 使用多工厂数据源配置，共 2 个工厂
2025-11-26 09:43:20,036 - INFO - 开始读取多工厂数据...
2025-11-26 09:43:20,037 - INFO - 开始读取 2 个工厂数据...
2025-11-26 09:43:20,037 - INFO - 正在读取 工厂1-CZM 数据...
2025-11-26 09:44:54,014 - INFO - ============================================================
2025-11-26 09:44:54,014 - INFO - 用户选择: 增量刷新
2025-11-26 09:44:54,014 - INFO - ============================================================
2025-11-26 09:44:54,015 - INFO - 使用多工厂数据源配置，共 2 个工厂
2025-11-26 09:44:54,015 - INFO - 开始读取多工厂数据...
2025-11-26 09:44:54,016 - INFO - 开始读取 2 个工厂数据...
2025-11-26 09:44:54,016 - INFO - 正在读取 工厂1-CZM 数据...
2025-11-26 09:46:10,535 - INFO - ✅ 工厂1-CZM: 成功读取 119291 行数据
2025-11-26 09:46:10,537 - INFO - 正在读取 工厂2-CKH 数据...
2025-11-26 09:47:36,929 - INFO - ✅ 工厂2-CKH: 成功读取 126486 行数据
2025-11-26 09:47:36,988 - INFO - ✅ 多工厂数据合并完成: 总计 245777 行数据
2025-11-26 09:47:37,042 - INFO - 各工厂数据量: {'CKH': 126486, 'CZM': 119291}
2025-11-26 09:47:37,070 - INFO - 数据包含 2 个工厂
2025-11-26 09:47:37,119 - INFO - 多工厂数据验证通过: 245777 条记录
2025-11-26 09:47:37,269 - INFO - 多工厂数据摘要: 总计 245777 条记录，包含 2 个工厂
2025-11-26 09:47:37,269 - INFO -   CZM (工厂1-CZM): 119291 条记录
2025-11-26 09:47:37,270 - INFO -   CKH (工厂2-CKH): 126486 条记录
2025-11-26 09:47:48,729 - INFO - 去重完成：移除 40 条重复记录（基于字段: ['BatchNumber', 'Operation', 'machine', 'factory_source']，排序字段: TrackOutTime）
2025-11-26 09:47:48,731 - INFO - 去重前: 163979 行，去重后: 163939 行
2025-11-26 09:47:48,840 - INFO - 未找到上次处理时间，执行全量刷新
2025-11-26 09:47:48,846 - INFO - 执行全量刷新：清除状态文件
2025-11-26 09:47:49,546 - INFO - 读取SFC数据: 49896 行
2025-11-26 09:47:49,774 - INFO - 合并SFC数据完成: 165177 行，匹配到Checkin_SFC: 40348 行
2025-11-26 09:47:49,776 - INFO - 使用标准时间表: SAP_Routing_latest.parquet
2025-11-26 09:47:50,043 - INFO - 读取合并后的标准时间表: 332430 行
2025-11-26 09:47:51,639 - INFO - 第一步Material Number匹配后，还有 266 条记录未匹配，尝试使用CFN匹配
2025-11-26 09:47:52,127 - INFO - 合并标准时间数据完成: 168194 行，总匹配成功: 167928 行
2025-11-26 09:47:52,128 - INFO - 匹配到EH_machine(s): 167928 行
2025-11-26 09:47:52,130 - INFO - 匹配到EH_labor(s): 167928 行
2025-11-26 09:47:52,132 - INFO - 匹配到OEE: 168194 行
2025-11-26 09:47:52,430 - INFO - 成功加载日历表: C:\Users\huangk14\OneDrive - Medtronic PLC\CZ Production - 文档\General\POWER BI 数据源 V2\30-MES导出数据\publish\日历工作日表.csv, 共1095条记录
2025-11-26 09:47:52,504 - INFO - 开始计算 PreviousBatchEndTime：有效machine记录 168194 条，总计 168194 条
2025-11-26 09:47:53,261 - INFO - 计算 PreviousBatchEndTime 完成：总计 168194 条，成功计算 168194 条（其中有效machine记录 168194 条）
2025-11-26 09:51:31,521 - INFO - MES数据字段筛选完成：保留 33 个字段
2025-11-26 09:51:31,854 - INFO - 加载历史数据: 224531 行
2025-11-26 09:51:32,727 - INFO - 数据合并完成：历史 224531 行 + 新增 168194 行 = 合并后 224531 行
2025-11-26 09:51:32,727 - INFO - 对所有合并后的数据统一计算 PreviousBatchEndTime
2025-11-26 09:51:32,871 - INFO - 开始计算 PreviousBatchEndTime：有效machine记录 224531 条，总计 224531 条
2025-11-26 09:51:33,571 - INFO - 计算 PreviousBatchEndTime 完成：总计 224531 条，成功计算 224531 条（其中有效machine记录 224531 条）
2025-11-26 09:51:33,764 - INFO - 已转换日期列 TrackOutDate 为datetime类型
2025-11-26 09:51:35,716 - INFO - 已保存Parquet文件: C:\Users\huangk14\OneDrive - Medtronic PLC\CZ Production - 文档\General\POWER BI 数据源 V2\30-MES导出数据\publish\MES_batch_report_latest.parquet, 行数: 224531
2025-11-26 09:51:35,841 - INFO - 数据量较大(224531行)，Excel文件只保存前200000行
2025-11-26 09:57:04,412 - INFO - 已保存Excel验证文件: C:\Users\huangk14\OneDrive - Medtronic PLC\CZ Production - 文档\General\POWER BI 数据源 V2\30-MES导出数据\publish\excel\MES_batch_report_latest.xlsx, 行数: 200000
2025-11-26 09:57:07,612 - INFO - ETL状态已更新: 总记录 224531, 新增 224531 条
2025-11-26 09:57:07,615 - INFO - 增量处理：已保存到latest文件并更新状态
2025-11-26 09:57:07,615 - INFO - 处理完成，耗时: 733.60秒
2025-11-26 11:11:39,108 - INFO - ============================================================
2025-11-26 11:11:39,110 - INFO - 无人值守模式启动
2025-11-26 11:11:39,111 - INFO - 刷新模式: 增量刷新
2025-11-26 11:11:39,111 - INFO - ============================================================
2025-11-26 11:11:39,111 - INFO - ============================================================
2025-11-26 11:11:39,112 - INFO - 用户选择: 增量刷新
2025-11-26 11:11:39,112 - INFO - ============================================================
2025-11-26 11:11:39,113 - INFO - 使用多工厂数据源配置，共 2 个工厂
2025-11-26 11:11:39,113 - INFO - 开始读取多工厂数据...
2025-11-26 11:11:39,114 - INFO - 开始读取 2 个工厂数据...
2025-11-26 11:11:39,114 - INFO - 正在读取 工厂1-CZM 数据...
2025-11-26 11:13:08,919 - INFO - ✅ 工厂1-CZM: 成功读取 119975 行数据
2025-11-26 11:13:08,921 - INFO - 正在读取 工厂2-CKH 数据...
2025-11-26 11:14:36,770 - INFO - ✅ 工厂2-CKH: 成功读取 126486 行数据
2025-11-26 11:14:37,044 - INFO - ✅ 多工厂数据合并完成: 总计 246461 行数据
2025-11-26 11:14:37,071 - INFO - 各工厂数据量: {'CKH': 126486, 'CZM': 119975}
2025-11-26 11:14:37,123 - INFO - 数据包含 2 个工厂
2025-11-26 11:14:37,141 - INFO - 多工厂数据验证通过: 246461 条记录
2025-11-26 11:14:37,304 - INFO - 多工厂数据摘要: 总计 246461 条记录，包含 2 个工厂
2025-11-26 11:14:37,306 - INFO -   CZM (工厂1-CZM): 119975 条记录
2025-11-26 11:14:37,308 - INFO -   CKH (工厂2-CKH): 126486 条记录
2025-11-26 11:14:51,623 - INFO - 去重完成：移除 40 条重复记录（基于字段: ['BatchNumber', 'Operation', 'machine', 'factory_source']，排序字段: TrackOutTime）
2025-11-26 11:14:51,625 - INFO - 去重前: 164601 行，去重后: 164561 行
2025-11-26 11:14:51,881 - INFO - 未找到上次处理时间，执行全量刷新
2025-11-26 11:14:51,887 - INFO - 执行全量刷新：清除状态文件
2025-11-26 11:14:52,524 - INFO - 读取SFC数据: 76213 行
2025-11-26 11:14:52,744 - INFO - 合并SFC数据完成: 166659 行，匹配到Checkin_SFC: 62576 行
2025-11-26 11:14:52,778 - INFO - 使用标准时间表: SAP_Routing_latest.parquet
2025-11-26 11:14:53,042 - INFO - 读取合并后的标准时间表: 332430 行
2025-11-26 11:14:54,558 - INFO - 第一步Material Number匹配后，还有 266 条记录未匹配，尝试使用CFN匹配
2025-11-26 11:14:54,896 - INFO - 合并标准时间数据完成: 169676 行，总匹配成功: 169410 行
2025-11-26 11:14:54,897 - INFO - 匹配到EH_machine(s): 169410 行
2025-11-26 11:14:54,898 - INFO - 匹配到EH_labor(s): 169410 行
2025-11-26 11:14:54,900 - INFO - 匹配到OEE: 169676 行
2025-11-26 11:14:55,127 - INFO - 成功加载日历表: C:\Users\huangk14\OneDrive - Medtronic PLC\CZ Production - 文档\General\POWER BI 数据源 V2\30-MES导出数据\publish\日历工作日表.csv, 共1095条记录
2025-11-26 11:14:55,197 - INFO - 开始计算 PreviousBatchEndTime：有效machine记录 169676 条，总计 169676 条
2025-11-26 11:14:55,853 - INFO - 计算 PreviousBatchEndTime 完成：总计 169676 条，成功计算 169676 条（其中有效machine记录 169676 条）
2025-11-26 11:17:02,371 - INFO - MES数据字段筛选完成：保留 33 个字段
2025-11-26 11:17:02,667 - INFO - 加载历史数据: 224531 行
2025-11-26 11:17:03,999 - INFO - 数据合并完成：历史 224531 行 + 新增 169676 行 = 合并后 225153 行
2025-11-26 11:17:04,045 - INFO - 对所有合并后的数据统一计算 PreviousBatchEndTime
2025-11-26 11:17:04,126 - INFO - 开始计算 PreviousBatchEndTime：有效machine记录 225153 条，总计 225153 条
2025-11-26 11:17:05,187 - INFO - 计算 PreviousBatchEndTime 完成：总计 225153 条，成功计算 225153 条（其中有效machine记录 225153 条）
2025-11-26 11:17:05,424 - INFO - 已转换日期列 TrackOutDate 为datetime类型
2025-11-26 11:17:07,115 - INFO - 已保存Parquet文件: C:\Users\huangk14\OneDrive - Medtronic PLC\CZ Production - 文档\General\POWER BI 数据源 V2\30-MES导出数据\publish\MES_batch_report_latest.parquet, 行数: 225153
2025-11-26 11:17:07,278 - INFO - 数据量较大(225153行)，Excel文件只保存前2000行
2025-11-26 11:17:11,011 - INFO - 已保存Excel验证文件: C:\Users\huangk14\OneDrive - Medtronic PLC\CZ Production - 文档\General\POWER BI 数据源 V2\30-MES导出数据\publish\excel\MES_batch_report_latest.xlsx, 行数: 2000
2025-11-26 11:17:14,539 - INFO - ETL状态已更新: 总记录 225153, 新增 225153 条
2025-11-26 11:17:14,597 - INFO - 增量处理：已保存到latest文件并更新状态
2025-11-26 11:17:14,598 - INFO - 处理完成，耗时: 335.48秒
2025-11-26 15:31:12,499 - INFO - ============================================================
2025-11-26 15:31:12,501 - INFO - 用户选择: 增量刷新
2025-11-26 15:31:12,502 - INFO - ============================================================
2025-11-26 15:31:12,503 - INFO - 使用多工厂数据源配置，共 2 个工厂
2025-11-26 15:31:12,503 - INFO - 开始读取多工厂数据...
2025-11-26 15:31:12,504 - INFO - 开始读取 2 个工厂数据...
2025-11-26 15:31:12,505 - INFO - 正在读取 工厂1-CZM 数据...
2025-11-26 15:36:19,605 - INFO - ============================================================
2025-11-26 15:36:19,607 - INFO - 用户选择: 增量刷新
2025-11-26 15:36:19,608 - INFO - ============================================================
2025-11-26 15:36:19,609 - INFO - 使用多工厂数据源配置，共 2 个工厂
2025-11-26 15:36:19,610 - INFO - 开始读取多工厂数据...
2025-11-26 15:36:19,611 - INFO - 开始读取 2 个工厂数据...
2025-11-26 15:36:19,612 - INFO - 正在读取 工厂1-CZM 数据...
2025-11-26 15:37:50,386 - INFO - ✅ 工厂1-CZM: 成功读取 119975 行数据
2025-11-26 15:37:50,388 - INFO - 正在读取 工厂2-CKH 数据...
2025-11-26 15:39:21,566 - INFO - ✅ 工厂2-CKH: 成功读取 126486 行数据
2025-11-26 15:39:21,684 - INFO - ✅ 多工厂数据合并完成: 总计 246461 行数据
2025-11-26 15:39:21,720 - INFO - 各工厂数据量: {'CKH': 126486, 'CZM': 119975}
2025-11-26 15:39:21,731 - INFO - 数据包含 2 个工厂
2025-11-26 15:39:21,796 - INFO - 多工厂数据验证通过: 246461 条记录
2025-11-26 15:39:22,081 - INFO - 多工厂数据摘要: 总计 246461 条记录，包含 2 个工厂
2025-11-26 15:39:22,084 - INFO -   CZM (工厂1-CZM): 119975 条记录
2025-11-26 15:39:22,086 - INFO -   CKH (工厂2-CKH): 126486 条记录
2025-11-26 15:39:35,031 - INFO - 去重完成：移除 40 条重复记录（基于字段: ['BatchNumber', 'Operation', 'machine', 'factory_source']，排序字段: TrackOutTime）
2025-11-26 15:39:35,033 - INFO - 去重前: 164601 行，去重后: 164561 行
2025-11-26 15:39:35,034 - INFO - 未找到上次处理时间，执行全量刷新
2025-11-26 15:39:35,034 - INFO - 执行全量刷新：清除状态文件
2025-11-26 15:39:36,127 - INFO - 读取SFC数据: 76213 行
2025-11-26 15:39:36,498 - INFO - 合并SFC数据完成: 166659 行，匹配到Checkin_SFC: 62576 行
2025-11-26 15:39:36,499 - INFO - 使用标准时间表: SAP_Routing_latest.parquet
2025-11-26 15:39:36,881 - INFO - 读取合并后的标准时间表: 332430 行
2025-11-26 15:39:38,778 - INFO - 第一步Material Number匹配后，还有 266 条记录未匹配，尝试使用CFN匹配
2025-11-26 15:39:39,254 - INFO - 合并标准时间数据完成: 169676 行，总匹配成功: 169410 行
2025-11-26 15:39:39,258 - INFO - 匹配到EH_machine(s): 169410 行
2025-11-26 15:39:39,262 - INFO - 匹配到EH_labor(s): 169410 行
2025-11-26 15:39:39,267 - INFO - 匹配到OEE: 169676 行
2025-11-26 15:39:39,731 - INFO - 成功加载日历表: C:\Users\huangk14\OneDrive - Medtronic PLC\CZ Production - 文档\General\POWER BI 数据源 V2\30-MES导出数据\publish\日历工作日表.csv, 共1095条记录
2025-11-26 15:39:39,805 - INFO - 开始计算 PreviousBatchEndTime：有效machine记录 169676 条，总计 169676 条
2025-11-26 15:39:40,656 - INFO - 计算 PreviousBatchEndTime 完成：总计 169676 条，成功计算 169676 条（其中有效machine记录 169676 条）
2025-11-26 15:41:19,051 - INFO - MES数据字段筛选完成：保留 33 个字段
2025-11-26 15:41:19,052 - INFO - 历史数据文件不存在，直接使用新数据
2025-11-26 15:41:19,052 - INFO - 对所有合并后的数据统一计算 PreviousBatchEndTime
2025-11-26 15:41:19,220 - INFO - 开始计算 PreviousBatchEndTime：有效machine记录 169676 条，总计 169676 条
2025-11-26 15:41:19,823 - INFO - 计算 PreviousBatchEndTime 完成：总计 169676 条，成功计算 169676 条（其中有效machine记录 169676 条）
2025-11-26 15:41:19,997 - INFO - 已转换日期列 TrackOutDate 为datetime类型
2025-11-26 15:41:21,716 - INFO - 已保存Parquet文件: C:\Users\huangk14\OneDrive - Medtronic PLC\CZ Production - 文档\General\POWER BI 数据源 V2\30-MES导出数据\publish\MES_batch_report_latest.parquet, 行数: 169676
2025-11-26 15:41:21,890 - INFO - 数据量较大(169676行)，Excel文件只保存前2000行
2025-11-26 15:41:25,056 - INFO - 已保存Excel验证文件: C:\Users\huangk14\OneDrive - Medtronic PLC\CZ Production - 文档\General\POWER BI 数据源 V2\30-MES导出数据\publish\excel\MES_batch_report_latest.xlsx, 行数: 2000
2025-11-26 15:41:26,852 - INFO - ETL状态已更新: 总记录 164561, 新增 164561 条
2025-11-26 15:41:26,853 - INFO - 增量处理：已保存到latest文件并更新状态
2025-11-26 15:41:26,853 - INFO - 处理完成，耗时: 307.24秒
2025-11-26 22:04:15,996 - INFO - 读取数据: 169676 行
2025-11-26 22:04:16,246 - INFO - 热数据层创建完成: 8 个分区，4462 行
2025-11-26 22:04:16,580 - INFO - 温数据层创建完成: 4 个分区，15784 行
2025-11-26 22:04:18,150 - INFO - 冷数据层创建完成: 10 个分区，149430 行
2025-11-26 22:04:18,166 - INFO - 分层元数据保存至: C:\Users\huangk14\OneDrive - Medtronic PLC\CZ Production - 文档\General\POWER BI 数据源 V2\30-MES导出数据\publish\layered_partitions\layered_metadata.json
2025-11-26 22:04:18,169 - ERROR - 创建分层分区失败: '\n                Partitions = partitionList,\n                Description = layerData'
2025-11-26 22:07:41,139 - INFO - 创建目录: C:\Users\huangk14\OneDrive - Medtronic PLC\CZ Production - 文档\General\POWER BI 数据源 V2\A1_ETL_Output\MES\batch_report\01_PROCESSED
2025-11-26 22:07:41,142 - INFO - 创建目录: C:\Users\huangk14\OneDrive - Medtronic PLC\CZ Production - 文档\General\POWER BI 数据源 V2\A1_ETL_Output\MES\batch_report\02_PUBLISH
2025-11-26 22:07:41,146 - INFO - 创建目录: C:\Users\huangk14\OneDrive - Medtronic PLC\CZ Production - 文档\General\POWER BI 数据源 V2\A1_ETL_Output\03_METADATA\MES\batch_report
2025-11-26 22:07:41,147 - INFO - 开始增量处理ETL...
2025-11-26 22:07:41,147 - INFO - 源文件: ['']
2025-11-26 22:07:41,148 - INFO - 开始数据清洗处理...
2025-11-26 22:07:41,148 - ERROR - ETL处理失败: name 'load_mes_data' is not defined
2025-11-26 22:09:18,741 - INFO - 创建目录: C:\Users\huangk14\OneDrive - Medtronic PLC\CZ Production - 文档\General\POWER BI 数据源 V2\A1_ETL_Output\MES\batch_report\01_PROCESSED
2025-11-26 22:09:18,743 - INFO - 创建目录: C:\Users\huangk14\OneDrive - Medtronic PLC\CZ Production - 文档\General\POWER BI 数据源 V2\A1_ETL_Output\MES\batch_report\02_PUBLISH
2025-11-26 22:09:18,746 - INFO - 创建目录: C:\Users\huangk14\OneDrive - Medtronic PLC\CZ Production - 文档\General\POWER BI 数据源 V2\A1_ETL_Output\03_METADATA\MES\batch_report
2025-11-26 22:09:18,748 - INFO - 开始增量处理ETL...
2025-11-26 22:09:18,749 - INFO - 源文件: ['']
2025-11-26 22:09:18,751 - INFO - 开始数据清洗处理...
2025-11-26 22:09:18,754 - INFO - 使用多工厂数据源配置，共 2 个工厂
2025-11-26 22:09:18,757 - INFO - 开始读取多工厂数据...
2025-11-26 22:09:18,759 - INFO - 开始读取 2 个工厂数据...
2025-11-26 22:09:18,762 - INFO - 正在读取 工厂1-CZM 数据...
2025-11-26 22:10:32,003 - INFO - ✅ 工厂1-CZM: 成功读取 119975 行数据
2025-11-26 22:10:32,006 - INFO - 正在读取 工厂2-CKH 数据...
2025-11-26 22:12:02,199 - INFO - ✅ 工厂2-CKH: 成功读取 126486 行数据
2025-11-26 22:12:02,400 - INFO - ✅ 多工厂数据合并完成: 总计 246461 行数据
2025-11-26 22:12:02,455 - INFO - 各工厂数据量: {'CKH': 126486, 'CZM': 119975}
2025-11-26 22:12:02,496 - INFO - 数据包含 2 个工厂
2025-11-26 22:12:02,508 - INFO - 多工厂数据验证通过: 246461 条记录
2025-11-26 22:12:02,695 - INFO - 多工厂数据摘要: 总计 246461 条记录，包含 2 个工厂
2025-11-26 22:12:02,695 - INFO -   CZM (工厂1-CZM): 119975 条记录
2025-11-26 22:12:02,697 - INFO -   CKH (工厂2-CKH): 126486 条记录
2025-11-26 22:12:14,723 - INFO - 去重完成：移除 40 条重复记录（基于字段: ['BatchNumber', 'Operation', 'machine', 'factory_source']，排序字段: TrackOutTime）
2025-11-26 22:12:14,725 - INFO - 去重前: 164601 行，去重后: 164561 行
2025-11-26 22:12:14,811 - INFO - 执行全量刷新：清除状态文件和历史数据文件
2025-11-26 22:12:14,820 - INFO - 已删除状态文件: C:\Users\huangk14\OneDrive - Medtronic PLC\CZ Production - 文档\General\POWER BI 数据源 V2\30-MES导出数据\publish\etl_mes_state.json
2025-11-26 22:12:14,823 - INFO - 已删除历史数据文件: C:\Users\huangk14\OneDrive - Medtronic PLC\CZ Production - 文档\General\POWER BI 数据源 V2\30-MES导出数据\publish\MES_batch_report_latest.parquet
2025-11-26 22:12:15,328 - INFO - 读取SFC数据: 76213 行
2025-11-26 22:12:15,686 - INFO - 合并SFC数据完成: 166659 行，匹配到Checkin_SFC: 62576 行
2025-11-26 22:12:15,746 - INFO - 使用标准时间表: SAP_Routing_latest.parquet
2025-11-26 22:12:16,006 - INFO - 读取合并后的标准时间表: 332430 行
2025-11-26 22:12:17,459 - INFO - 第一步Material Number匹配后，还有 266 条记录未匹配，尝试使用CFN匹配
2025-11-26 22:12:17,838 - INFO - 合并标准时间数据完成: 169676 行，总匹配成功: 169410 行
2025-11-26 22:12:17,840 - INFO - 匹配到EH_machine(s): 169410 行
2025-11-26 22:12:17,841 - INFO - 匹配到EH_labor(s): 169410 行
2025-11-26 22:12:17,841 - INFO - 匹配到OEE: 169676 行
2025-11-26 22:12:18,109 - INFO - 成功加载日历表: C:\Users\huangk14\OneDrive - Medtronic PLC\CZ Production - 文档\General\POWER BI 数据源 V2\30-MES导出数据\publish\日历工作日表.csv, 共1095条记录
2025-11-26 22:12:18,173 - INFO - 开始计算 PreviousBatchEndTime：有效machine记录 169676 条，总计 169676 条
2025-11-26 22:12:18,918 - INFO - 计算 PreviousBatchEndTime 完成：总计 169676 条，成功计算 169676 条（其中有效machine记录 169676 条）
2025-11-26 22:13:46,571 - INFO - MES数据字段筛选完成：保留 33 个字段
2025-11-26 22:13:46,591 - INFO - 历史数据文件不存在，直接使用新数据
2025-11-26 22:13:46,592 - INFO - 对所有合并后的数据统一计算 PreviousBatchEndTime
2025-11-26 22:13:46,619 - INFO - 开始计算 PreviousBatchEndTime：有效machine记录 169676 条，总计 169676 条
2025-11-26 22:13:47,103 - INFO - 计算 PreviousBatchEndTime 完成：总计 169676 条，成功计算 169676 条（其中有效machine记录 169676 条）
2025-11-26 22:13:47,138 - INFO - 开始记录级变更检测...
2025-11-26 22:13:49,653 - INFO - 变更检测完成: 总记录 169676, 新记录 169676, 重复记录 0.0%
2025-11-26 22:13:49,741 - INFO - 数据清洗完成: 169676 行，识别新记录: 169676 行
2025-11-26 22:13:49,755 - INFO - 保存数据到PROCESSED层...
2025-11-26 22:13:50,324 - INFO - 保存增量文件: C:\Users\huangk14\OneDrive - Medtronic PLC\CZ Production - 文档\General\POWER BI 数据源 V2\A1_ETL_Output\MES\batch_report\01_PROCESSED\2025\11\26\incremental_mes_batch_report_20251126_221349.parquet
2025-11-26 22:13:55,511 - INFO - 保存记录哈希: 164561 个记录
2025-11-26 22:13:55,536 - INFO - 更新水位线: 2025-11-26, 总记录数: 169676
2025-11-26 22:13:55,636 - INFO - 合并增量数据到全量文件...
2025-11-26 22:13:55,744 - INFO - 读取增量文件: C:\Users\huangk14\OneDrive - Medtronic PLC\CZ Production - 文档\General\POWER BI 数据源 V2\A1_ETL_Output\MES\batch_report\01_PROCESSED\2025\11\26\incremental_mes_batch_report_20251126_221349.parquet (169676 行)
2025-11-26 22:13:55,803 - INFO - 去重: 169676 -> 164561 行
2025-11-26 22:13:56,294 - INFO - 保存全量文件: C:\Users\huangk14\OneDrive - Medtronic PLC\CZ Production - 文档\General\POWER BI 数据源 V2\A1_ETL_Output\MES\batch_report\01_PROCESSED\2025\11\26\mes_batch_report_full_20251126_221355.parquet (164561 行)
2025-11-26 22:13:56,310 - INFO - 发布数据到PUBLISH层...
2025-11-26 22:13:56,999 - INFO - 保存latest文件: C:\Users\huangk14\OneDrive - Medtronic PLC\CZ Production - 文档\General\POWER BI 数据源 V2\A1_ETL_Output\MES\batch_report\02_PUBLISH\latest\mes_batch_report_latest.parquet
2025-11-26 22:13:57,513 - INFO - 保存daily快照: C:\Users\huangk14\OneDrive - Medtronic PLC\CZ Production - 文档\General\POWER BI 数据源 V2\A1_ETL_Output\MES\batch_report\02_PUBLISH\daily\mes_batch_report_20251126.parquet
2025-11-26 22:13:57,542 - INFO - 数据血缘信息保存至: C:\Users\huangk14\OneDrive - Medtronic PLC\CZ Production - 文档\General\POWER BI 数据源 V2\A1_ETL_Output\03_METADATA\MES\batch_report\data_lineage.json
2025-11-26 22:13:57,543 - INFO - 增量处理ETL完成!
2025-11-26 22:13:57,543 - INFO - 增量统计: {'total_records': 169676, 'new_records': 169676, 'duplicate_records': 0, 'duplicate_percentage': 0.0}
2025-11-26 22:13:57,544 - INFO - 处理记录数: 169676
2025-11-26 22:13:57,544 - INFO - 生成文件数: 3
2025-11-27 08:54:30,358 - INFO - ============================================================
2025-11-27 08:54:30,359 - INFO - 用户选择: 增量刷新
2025-11-27 08:54:30,360 - INFO - ============================================================
2025-11-27 08:54:30,361 - INFO - 使用多工厂数据源配置，共 2 个工厂
2025-11-27 08:54:30,362 - INFO - 开始读取多工厂数据...
2025-11-27 08:54:30,363 - INFO - 开始读取 2 个工厂数据...
2025-11-27 08:54:30,363 - INFO - 正在读取 工厂1-CZM 数据...
2025-11-27 08:55:57,240 - INFO - ✅ 工厂1-CZM: 成功读取 120618 行数据
2025-11-27 08:55:57,242 - INFO - 正在读取 工厂2-CKH 数据...
2025-11-27 08:56:46,592 - INFO - ✅ 工厂2-CKH: 成功读取 126486 行数据
2025-11-27 08:56:46,733 - INFO - ✅ 多工厂数据合并完成: 总计 247104 行数据
2025-11-27 08:56:46,780 - INFO - 各工厂数据量: {'CKH': 126486, 'CZM': 120618}
2025-11-27 08:56:46,795 - INFO - 数据包含 2 个工厂
2025-11-27 08:56:46,825 - INFO - 多工厂数据验证通过: 247104 条记录
2025-11-27 08:56:46,931 - INFO - 多工厂数据摘要: 总计 247104 条记录，包含 2 个工厂
2025-11-27 08:56:46,932 - INFO -   CZM (工厂1-CZM): 120618 条记录
2025-11-27 08:56:46,932 - INFO -   CKH (工厂2-CKH): 126486 条记录
2025-11-27 08:56:53,636 - INFO - 去重完成：移除 40 条重复记录（基于字段: ['BatchNumber', 'Operation', 'machine', 'factory_source']，排序字段: TrackOutTime）
2025-11-27 08:56:53,637 - INFO - 去重前: 165195 行，去重后: 165155 行
2025-11-27 08:56:53,639 - INFO - 执行增量处理：过滤新数据
2025-11-27 08:56:57,276 - INFO - 增量过滤：总数据 165155 行，已处理 0 行，新数据 165155 行
2025-11-27 08:56:58,796 - INFO - 读取SFC数据: 76213 行
2025-11-27 08:56:59,192 - INFO - 合并SFC数据完成: 167260 行，匹配到Checkin_SFC: 62590 行
2025-11-27 08:56:59,202 - INFO - 使用标准时间表: SAP_Routing_latest.parquet
2025-11-27 08:56:59,396 - INFO - 读取合并后的标准时间表: 332430 行
2025-11-27 08:57:00,358 - INFO - 第一步Material Number匹配后，还有 267 条记录未匹配，尝试使用CFN匹配
2025-11-27 08:57:00,589 - INFO - 合并标准时间数据完成: 170277 行，总匹配成功: 170010 行
2025-11-27 08:57:00,590 - INFO - 匹配到EH_machine(s): 170010 行
2025-11-27 08:57:00,591 - INFO - 匹配到EH_labor(s): 170010 行
2025-11-27 08:57:00,592 - INFO - 匹配到OEE: 170277 行
2025-11-27 08:57:00,822 - INFO - 成功加载日历表: C:\Users\huangk14\OneDrive - Medtronic PLC\CZ Production - 文档\General\POWER BI 数据源 V2\30-MES导出数据\publish\日历工作日表.csv, 共1095条记录
2025-11-27 08:57:00,871 - INFO - 开始计算 PreviousBatchEndTime：有效machine记录 170277 条，总计 170277 条
2025-11-27 08:57:01,534 - INFO - 计算 PreviousBatchEndTime 完成：总计 170277 条，成功计算 170277 条（其中有效machine记录 170277 条）
2025-11-27 08:57:53,627 - INFO - MES数据字段筛选完成：保留 33 个字段
2025-11-27 08:57:53,628 - INFO - 历史数据文件不存在，直接使用新数据
2025-11-27 08:57:53,628 - INFO - 对所有合并后的数据统一计算 PreviousBatchEndTime
2025-11-27 08:57:53,749 - INFO - 开始计算 PreviousBatchEndTime：有效machine记录 170277 条，总计 170277 条
2025-11-27 08:57:54,132 - INFO - 计算 PreviousBatchEndTime 完成：总计 170277 条，成功计算 170277 条（其中有效machine记录 170277 条）
2025-11-27 08:57:54,179 - INFO - 已转换日期列 TrackOutDate 为datetime类型
2025-11-27 08:57:55,348 - INFO - 已保存Parquet文件: C:\Users\huangk14\OneDrive - Medtronic PLC\CZ Production - 文档\General\POWER BI 数据源 V2\30-MES导出数据\publish\MES_batch_report_latest.parquet, 行数: 170277
2025-11-27 08:57:55,448 - INFO - 数据量较大(170277行)，Excel文件只保存前2000行
2025-11-27 08:57:57,118 - INFO - 已保存Excel验证文件: C:\Users\huangk14\OneDrive - Medtronic PLC\CZ Production - 文档\General\POWER BI 数据源 V2\30-MES导出数据\publish\excel\MES_batch_report_latest.xlsx, 行数: 2000
2025-11-27 08:57:58,380 - INFO - ETL状态已更新: 总记录 165155, 新增 165155 条
2025-11-27 08:57:58,381 - INFO - 增量处理：已保存到latest文件并更新状态
2025-11-27 08:57:58,381 - INFO - 处理完成，耗时: 208.02秒
2025-11-28 08:26:31,884 - INFO - ============================================================
2025-11-28 08:26:31,886 - INFO - 用户选择: 增量刷新
2025-11-28 08:26:31,887 - INFO - ============================================================
2025-11-28 08:26:31,888 - INFO - 使用多工厂数据源配置，共 2 个工厂
2025-11-28 08:26:31,888 - INFO - 开始读取多工厂数据...
2025-11-28 08:26:31,889 - INFO - 开始读取 2 个工厂数据...
2025-11-28 08:26:31,889 - INFO - 正在读取 工厂1-CZM 数据...
2025-11-28 08:27:59,781 - INFO - ✅ 工厂1-CZM: 成功读取 120618 行数据
2025-11-28 08:27:59,783 - INFO - 正在读取 工厂2-CKH 数据...
2025-11-28 08:29:39,901 - INFO - ✅ 工厂2-CKH: 成功读取 126486 行数据
2025-11-28 08:29:39,960 - INFO - ✅ 多工厂数据合并完成: 总计 247104 行数据
2025-11-28 08:29:39,997 - INFO - 各工厂数据量: {'CKH': 126486, 'CZM': 120618}
2025-11-28 08:29:40,008 - INFO - 数据包含 2 个工厂
2025-11-28 08:29:40,043 - INFO - 多工厂数据验证通过: 247104 条记录
2025-11-28 08:29:40,201 - INFO - 多工厂数据摘要: 总计 247104 条记录，包含 2 个工厂
2025-11-28 08:29:40,202 - INFO -   CZM (工厂1-CZM): 120618 条记录
2025-11-28 08:29:40,202 - INFO -   CKH (工厂2-CKH): 126486 条记录
2025-11-28 08:29:52,196 - INFO - 去重完成：移除 40 条重复记录（基于字段: ['BatchNumber', 'Operation', 'machine', 'factory_source']，排序字段: TrackOutTime）
2025-11-28 08:29:52,197 - INFO - 去重前: 165195 行，去重后: 165155 行
2025-11-28 08:29:52,198 - INFO - 执行增量处理：过滤新数据
2025-11-28 08:30:00,501 - INFO - 增量过滤：总数据 165155 行，已处理 0 行，新数据 165155 行
2025-11-28 08:30:01,279 - INFO - 读取SFC数据: 76213 行
2025-11-28 08:30:01,585 - INFO - 合并SFC数据完成: 167260 行，匹配到Checkin_SFC: 62590 行
2025-11-28 08:30:01,586 - INFO - 使用标准时间表: SAP_Routing_latest.parquet
2025-11-28 08:30:01,807 - INFO - 读取合并后的标准时间表: 332430 行
2025-11-28 08:30:03,282 - INFO - 第一步Material Number匹配后，还有 267 条记录未匹配，尝试使用CFN匹配
2025-11-28 08:30:03,682 - INFO - 合并标准时间数据完成: 170277 行，总匹配成功: 170010 行
2025-11-28 08:30:03,684 - INFO - 匹配到EH_machine(s): 170010 行
2025-11-28 08:30:03,686 - INFO - 匹配到EH_labor(s): 170010 行
2025-11-28 08:30:03,690 - INFO - 匹配到OEE: 170277 行
2025-11-28 08:30:04,097 - INFO - 成功加载日历表: C:\Users\huangk14\OneDrive - Medtronic PLC\CZ Production - 文档\General\POWER BI 数据源 V2\30-MES导出数据\publish\日历工作日表.csv, 共1095条记录
2025-11-28 08:30:04,179 - INFO - 开始计算 PreviousBatchEndTime：有效machine记录 170277 条，总计 170277 条
2025-11-28 08:30:04,898 - INFO - 计算 PreviousBatchEndTime 完成：总计 170277 条，成功计算 170277 条（其中有效machine记录 170277 条）
2025-11-28 08:32:09,793 - INFO - MES数据字段筛选完成：保留 33 个字段
2025-11-28 08:32:10,072 - INFO - 加载历史数据: 170277 行
2025-11-28 08:32:10,859 - INFO - 数据合并完成：历史 170277 行 + 新增 170277 行 = 合并后 165155 行
2025-11-28 08:32:10,861 - INFO - 对所有合并后的数据统一计算 PreviousBatchEndTime
2025-11-28 08:32:11,007 - INFO - 开始计算 PreviousBatchEndTime：有效machine记录 165155 条，总计 165155 条
2025-11-28 08:32:11,707 - INFO - 计算 PreviousBatchEndTime 完成：总计 165155 条，成功计算 165155 条（其中有效machine记录 165155 条）
2025-11-28 08:32:11,870 - INFO - 已转换日期列 TrackOutDate 为datetime类型
2025-11-28 08:32:13,754 - INFO - 已保存Parquet文件: C:\Users\huangk14\OneDrive - Medtronic PLC\CZ Production - 文档\General\POWER BI 数据源 V2\30-MES导出数据\publish\MES_batch_report_latest.parquet, 行数: 165155
2025-11-28 08:32:13,847 - INFO - 数据量较大(165155行)，Excel文件只保存前2000行
2025-11-28 08:32:16,495 - INFO - 已保存Excel验证文件: C:\Users\huangk14\OneDrive - Medtronic PLC\CZ Production - 文档\General\POWER BI 数据源 V2\30-MES导出数据\publish\excel\MES_batch_report_latest.xlsx, 行数: 2000
2025-11-28 08:32:18,542 - INFO - ETL状态已更新: 总记录 165155, 新增 0 条
2025-11-28 08:32:18,543 - INFO - 增量处理：已保存到latest文件并更新状态
2025-11-28 08:32:18,543 - INFO - 处理完成，耗时: 346.66秒
2025-12-01 09:25:33,765 - INFO - ============================================================
2025-12-01 09:25:33,766 - INFO - 用户选择: 增量刷新
2025-12-01 09:25:33,767 - INFO - ============================================================
2025-12-01 09:25:33,767 - INFO - 使用多工厂数据源配置，共 2 个工厂
2025-12-01 09:25:33,767 - INFO - 开始读取多工厂数据...
2025-12-01 09:25:33,767 - INFO - 开始读取 2 个工厂数据...
2025-12-01 09:25:33,767 - INFO - 正在读取 工厂1-CZM 数据...
2025-12-01 09:27:05,720 - INFO - ✅ 工厂1-CZM: 成功读取 121973 行数据
2025-12-01 09:27:05,728 - INFO - 正在读取 工厂2-CKH 数据...
2025-12-01 09:28:20,923 - INFO - ✅ 工厂2-CKH: 成功读取 126486 行数据
2025-12-01 09:28:21,086 - INFO - ✅ 多工厂数据合并完成: 总计 248459 行数据
2025-12-01 09:28:21,097 - INFO - 各工厂数据量: {'CKH': 126486, 'CZM': 121973}
2025-12-01 09:28:21,130 - INFO - 数据包含 2 个工厂
2025-12-01 09:28:21,136 - INFO - 多工厂数据验证通过: 248459 条记录
2025-12-01 09:28:21,252 - INFO - 多工厂数据摘要: 总计 248459 条记录，包含 2 个工厂
2025-12-01 09:28:21,252 - INFO -   CZM (工厂1-CZM): 121973 条记录
2025-12-01 09:28:21,253 - INFO -   CKH (工厂2-CKH): 126486 条记录
2025-12-01 09:28:33,169 - INFO - 去重完成：移除 40 条重复记录（基于字段: ['BatchNumber', 'Operation', 'machine', 'factory_source']，排序字段: TrackOutTime）
2025-12-01 09:28:33,170 - INFO - 去重前: 166429 行，去重后: 166389 行
2025-12-01 09:28:33,220 - INFO - 执行增量处理：过滤新数据
2025-12-01 09:28:42,829 - INFO - 增量过滤：总数据 166389 行，已处理 0 行，新数据 166389 行
2025-12-01 09:28:43,545 - INFO - 读取SFC数据: 76213 行
2025-12-01 09:28:43,805 - INFO - 合并SFC数据完成: 168508 行，匹配到Checkin_SFC: 62604 行
2025-12-01 09:28:43,836 - INFO - 使用标准时间表: SAP_Routing_latest.parquet
2025-12-01 09:28:44,062 - INFO - 读取合并后的标准时间表: 332430 行
2025-12-01 09:28:45,645 - INFO - 第一步Material Number匹配后，还有 278 条记录未匹配，尝试使用CFN匹配
2025-12-01 09:28:46,066 - INFO - 合并标准时间数据完成: 171525 行，总匹配成功: 171247 行
2025-12-01 09:28:46,067 - INFO - 匹配到EH_machine(s): 171247 行
2025-12-01 09:28:46,070 - INFO - 匹配到EH_labor(s): 171247 行
2025-12-01 09:28:46,072 - INFO - 匹配到OEE: 171525 行
2025-12-01 09:28:46,319 - INFO - 成功加载日历表: C:\Users\huangk14\OneDrive - Medtronic PLC\CZ Production - 文档\General\POWER BI 数据源 V2\30-MES导出数据\publish\日历工作日表.csv, 共1095条记录
2025-12-01 09:28:46,393 - INFO - 开始计算 PreviousBatchEndTime：有效machine记录 171525 条，总计 171525 条
2025-12-01 09:28:47,323 - INFO - 计算 PreviousBatchEndTime 完成：总计 171525 条，成功计算 171525 条（其中有效machine记录 171525 条）
2025-12-01 09:30:48,644 - INFO - MES数据字段筛选完成：保留 33 个字段
2025-12-01 09:30:48,863 - INFO - 加载历史数据: 165155 行
2025-12-01 09:30:49,730 - INFO - 数据合并完成：历史 165155 行 + 新增 171525 行 = 合并后 166389 行
2025-12-01 09:30:49,759 - INFO - 对所有合并后的数据统一计算 PreviousBatchEndTime
2025-12-01 09:30:49,808 - INFO - 开始计算 PreviousBatchEndTime：有效machine记录 166389 条，总计 166389 条
2025-12-01 09:30:50,714 - INFO - 计算 PreviousBatchEndTime 完成：总计 166389 条，成功计算 166389 条（其中有效machine记录 166389 条）
2025-12-01 09:30:51,003 - INFO - 已转换日期列 TrackOutDate 为datetime类型
2025-12-01 09:30:52,959 - INFO - 已保存Parquet文件: C:\Users\huangk14\OneDrive - Medtronic PLC\CZ Production - 文档\General\POWER BI 数据源 V2\30-MES导出数据\publish\MES_batch_report_latest.parquet, 行数: 166389
2025-12-01 09:30:53,071 - INFO - 数据量较大(166389行)，Excel文件只保存前2000行
2025-12-01 09:30:56,370 - INFO - 已保存Excel验证文件: C:\Users\huangk14\OneDrive - Medtronic PLC\CZ Production - 文档\General\POWER BI 数据源 V2\30-MES导出数据\publish\excel\MES_batch_report_latest.xlsx, 行数: 2000
2025-12-01 09:30:59,254 - INFO - ETL状态已更新: 总记录 166389, 新增 1234 条
2025-12-01 09:30:59,320 - INFO - 增量处理：已保存到latest文件并更新状态
2025-12-01 09:30:59,321 - INFO - 处理完成，耗时: 325.55秒
2025-12-01 10:54:18,015 - INFO - ============================================================
2025-12-01 10:54:18,016 - INFO - 用户选择: 增量刷新
2025-12-01 10:54:18,017 - INFO - ============================================================
2025-12-01 10:54:18,017 - INFO - 使用多工厂数据源配置，共 2 个工厂
2025-12-01 10:54:18,017 - INFO - 开始读取多工厂数据...
2025-12-01 10:54:18,018 - INFO - 开始读取 2 个工厂数据...
2025-12-01 10:54:18,018 - INFO - 正在读取 工厂1-CZM 数据...
2025-12-01 10:55:59,337 - INFO - ✅ 工厂1-CZM: 成功读取 121973 行数据
2025-12-01 10:55:59,348 - INFO - 正在读取 工厂2-CKH 数据...
2025-12-01 10:57:55,071 - INFO - ✅ 工厂2-CKH: 成功读取 126486 行数据
2025-12-01 10:57:55,381 - INFO - ✅ 多工厂数据合并完成: 总计 248459 行数据
2025-12-01 10:57:55,466 - INFO - 各工厂数据量: {'CKH': 126486, 'CZM': 121973}
2025-12-01 10:57:55,514 - INFO - 数据包含 2 个工厂
2025-12-01 10:57:55,530 - INFO - 多工厂数据验证通过: 248459 条记录
2025-12-01 10:57:55,810 - INFO - 多工厂数据摘要: 总计 248459 条记录，包含 2 个工厂
2025-12-01 10:57:55,812 - INFO -   CZM (工厂1-CZM): 121973 条记录
2025-12-01 10:57:55,812 - INFO -   CKH (工厂2-CKH): 126486 条记录
2025-12-01 10:58:08,277 - INFO - 去重完成：移除 40 条重复记录（基于字段: ['BatchNumber', 'Operation', 'machine', 'factory_source']，排序字段: TrackOutTime）
2025-12-01 10:58:08,278 - INFO - 去重前: 166429 行，去重后: 166389 行
2025-12-01 10:58:08,326 - INFO - 执行增量处理：过滤新数据
2025-12-01 10:58:16,182 - INFO - 增量过滤：总数据 166389 行，已处理 0 行，新数据 166389 行
2025-12-01 10:58:18,217 - INFO - 读取SFC数据: 78334 行
2025-12-01 10:58:18,557 - INFO - 合并SFC数据完成: 168580 行，匹配到Checkin_SFC: 64305 行
2025-12-01 10:58:18,586 - INFO - 使用标准时间表: SAP_Routing_latest.parquet
2025-12-01 10:58:18,807 - INFO - 读取合并后的标准时间表: 332430 行
2025-12-01 10:58:20,428 - INFO - 第一步Material Number匹配后，还有 278 条记录未匹配，尝试使用CFN匹配
2025-12-01 10:58:20,819 - INFO - 合并标准时间数据完成: 171597 行，总匹配成功: 171319 行
2025-12-01 10:58:20,820 - INFO - 匹配到EH_machine(s): 171319 行
2025-12-01 10:58:20,822 - INFO - 匹配到EH_labor(s): 171319 行
2025-12-01 10:58:20,824 - INFO - 匹配到OEE: 171597 行
2025-12-01 10:58:21,207 - INFO - 成功加载日历表: C:\Users\huangk14\OneDrive - Medtronic PLC\CZ Production - 文档\General\POWER BI 数据源 V2\30-MES导出数据\publish\日历工作日表.csv, 共1095条记录
2025-12-01 10:58:21,352 - INFO - 开始计算 PreviousBatchEndTime：有效machine记录 171597 条，总计 171597 条
2025-12-01 10:58:22,405 - INFO - 计算 PreviousBatchEndTime 完成：总计 171597 条，成功计算 171597 条（其中有效machine记录 171597 条）
2025-12-01 11:00:18,842 - INFO - MES数据字段筛选完成：保留 33 个字段
2025-12-01 11:00:19,028 - INFO - 加载历史数据: 166389 行
2025-12-01 11:00:19,854 - INFO - 数据合并完成：历史 166389 行 + 新增 171597 行 = 合并后 166389 行
2025-12-01 11:00:19,881 - INFO - 对所有合并后的数据统一计算 PreviousBatchEndTime
2025-12-01 11:00:19,928 - INFO - 开始计算 PreviousBatchEndTime：有效machine记录 166389 条，总计 166389 条
2025-12-01 11:00:20,712 - INFO - 计算 PreviousBatchEndTime 完成：总计 166389 条，成功计算 166389 条（其中有效machine记录 166389 条）
2025-12-01 11:00:20,896 - INFO - 已转换日期列 TrackOutDate 为datetime类型
2025-12-01 11:00:22,798 - INFO - 已保存Parquet文件: C:\Users\huangk14\OneDrive - Medtronic PLC\CZ Production - 文档\General\POWER BI 数据源 V2\30-MES导出数据\publish\MES_batch_report_latest.parquet, 行数: 166389
2025-12-01 11:00:22,894 - INFO - 数据量较大(166389行)，Excel文件只保存前2000行
2025-12-01 11:00:26,199 - INFO - 已保存Excel验证文件: C:\Users\huangk14\OneDrive - Medtronic PLC\CZ Production - 文档\General\POWER BI 数据源 V2\30-MES导出数据\publish\excel\MES_batch_report_latest.xlsx, 行数: 2000
2025-12-01 11:00:29,288 - INFO - ETL状态已更新: 总记录 166389, 新增 0 条
2025-12-01 11:00:29,324 - INFO - 增量处理：已保存到latest文件并更新状态
2025-12-01 11:00:29,324 - INFO - 处理完成，耗时: 371.31秒
2025-12-02 09:15:07,348 - INFO - ============================================================
2025-12-02 09:15:07,350 - INFO - 用户选择: 增量刷新
2025-12-02 09:15:07,351 - INFO - ============================================================
2025-12-02 09:15:07,351 - INFO - 使用多工厂数据源配置，共 2 个工厂
2025-12-02 09:15:07,351 - INFO - 开始读取多工厂数据...
2025-12-02 09:15:07,353 - INFO - 开始读取 2 个工厂数据...
2025-12-02 09:15:07,353 - INFO - 正在读取 工厂1-CZM 数据...
2025-12-02 09:18:16,658 - INFO - ✅ 工厂1-CZM: 成功读取 121973 行数据
2025-12-02 09:18:16,708 - INFO - 正在读取 工厂2-CKH 数据...
2025-12-02 09:21:25,524 - INFO - ✅ 工厂2-CKH: 成功读取 126486 行数据
2025-12-02 09:21:25,866 - INFO - ✅ 多工厂数据合并完成: 总计 248459 行数据
2025-12-02 09:21:25,907 - INFO - 各工厂数据量: {'CKH': 126486, 'CZM': 121973}
2025-12-02 09:21:25,985 - INFO - 数据包含 2 个工厂
2025-12-02 09:21:26,011 - INFO - 多工厂数据验证通过: 248459 条记录
2025-12-02 09:21:26,397 - INFO - 多工厂数据摘要: 总计 248459 条记录，包含 2 个工厂
2025-12-02 09:21:26,399 - INFO -   CZM (工厂1-CZM): 121973 条记录
2025-12-02 09:21:26,400 - INFO -   CKH (工厂2-CKH): 126486 条记录
2025-12-02 09:21:54,269 - INFO - 去重完成：移除 40 条重复记录（基于字段: ['BatchNumber', 'Operation', 'machine', 'factory_source']，排序字段: TrackOutTime）
2025-12-02 09:21:54,270 - INFO - 去重前: 166429 行，去重后: 166389 行
2025-12-02 09:21:54,383 - INFO - 执行增量处理：过滤新数据
2025-12-02 09:22:11,800 - INFO - 增量过滤：总数据 166389 行，已处理 0 行，新数据 166389 行
2025-12-02 09:22:12,594 - INFO - 读取SFC数据: 78750 行
2025-12-02 09:22:13,176 - INFO - 合并SFC数据完成: 168580 行，匹配到Checkin_SFC: 64320 行
2025-12-02 09:22:13,234 - INFO - 使用标准时间表: SAP_Routing_latest.parquet
2025-12-02 09:22:13,732 - INFO - 读取合并后的标准时间表: 332430 行
2025-12-02 09:22:17,053 - INFO - 第一步Material Number匹配后，还有 278 条记录未匹配，尝试使用CFN匹配
2025-12-02 09:22:17,985 - INFO - 合并标准时间数据完成: 171597 行，总匹配成功: 171319 行
2025-12-02 09:22:17,989 - INFO - 匹配到EH_machine(s): 171319 行
2025-12-02 09:22:17,992 - INFO - 匹配到EH_labor(s): 171319 行
2025-12-02 09:22:17,995 - INFO - 匹配到OEE: 171597 行
2025-12-02 09:22:18,527 - INFO - 成功加载日历表: C:\Users\huangk14\OneDrive - Medtronic PLC\CZ Production - 文档\General\POWER BI 数据源 V2\30-MES导出数据\publish\日历工作日表.csv, 共1095条记录
2025-12-02 09:22:18,743 - INFO - 开始计算 PreviousBatchEndTime：有效machine记录 171597 条，总计 171597 条
2025-12-02 09:22:20,689 - INFO - 计算 PreviousBatchEndTime 完成：总计 171597 条，成功计算 171597 条（其中有效machine记录 171597 条）
2025-12-02 09:26:08,630 - INFO - MES数据字段筛选完成：保留 33 个字段
2025-12-02 09:26:09,091 - INFO - 加载历史数据: 166389 行
2025-12-02 09:26:10,808 - INFO - 数据合并完成：历史 166389 行 + 新增 171597 行 = 合并后 166389 行
2025-12-02 09:26:10,868 - INFO - 对所有合并后的数据统一计算 PreviousBatchEndTime
2025-12-02 09:26:10,969 - INFO - 开始计算 PreviousBatchEndTime：有效machine记录 166389 条，总计 166389 条
2025-12-02 09:26:12,702 - INFO - 计算 PreviousBatchEndTime 完成：总计 166389 条，成功计算 166389 条（其中有效machine记录 166389 条）
2025-12-02 09:26:13,082 - INFO - 已转换日期列 TrackOutDate 为datetime类型
2025-12-02 09:26:16,741 - INFO - 已保存Parquet文件: C:\Users\huangk14\OneDrive - Medtronic PLC\CZ Production - 文档\General\POWER BI 数据源 V2\30-MES导出数据\publish\MES_batch_report_latest.parquet, 行数: 166389
2025-12-02 09:26:16,930 - INFO - 数据量较大(166389行)，Excel文件只保存前2000行
2025-12-02 09:26:23,208 - INFO - 已保存Excel验证文件: C:\Users\huangk14\OneDrive - Medtronic PLC\CZ Production - 文档\General\POWER BI 数据源 V2\30-MES导出数据\publish\excel\MES_batch_report_latest.xlsx, 行数: 2000
2025-12-02 09:26:28,850 - INFO - ETL状态已更新: 总记录 166389, 新增 0 条
2025-12-02 09:26:29,022 - INFO - 增量处理：已保存到latest文件并更新状态
2025-12-02 09:26:29,022 - INFO - 处理完成，耗时: 681.67秒
