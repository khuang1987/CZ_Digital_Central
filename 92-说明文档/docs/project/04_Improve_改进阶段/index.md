# 改进阶段（Improve）

本阶段在平台视角下落地对策，确保可复用、可追溯、可运维。SA/SFC 为试点域，其机制将复用到各部门指标。

## 目标
- 统一口径与治理：配置中心、日历服务、标准时间接口、字典表。
- 稳健刷新：增量重跑窗口、补数机制、异常自动重试与告警。
- 一致性保障：聚合后“一致性回放”作为发布前校验点。

## 关键措施
- 配置治理与版本化：主配置 + 环境覆盖，变更审计与回滚。
- 日历与班次服务：脚本生成 + 规则统一，跨日/节假日一致口径。
- 标准时间统一接口：ETL 统一调用并记录校验日志。
- 监控与可观测：任务耗时、记录数、异常摘要与通知。

## 关联技术产出
- 进展总览与路线：`project/progress.md`

---

## To-Be 流程（优化后）

```mermaid
flowchart TD
    A[统一配置中心\nconfig.yaml / 日历服务] --> B[数据抽取\nPQ/Parquet/CSV]
    B --> C[原始区 Raw + 版本标记]
    C --> D[清洗与标准化\n统一口径/异常处理]
    D --> E[标准时间服务\n统一转换/校验]
    E --> F[指标聚合\n与DAX口径一致性校验]
    F --> G[增量刷新\n含补数/重跑策略]
    G --> H[发布与监控\nPower BI + 告警]

    A -. 配置版本化/审计 .-> D
    G -. 重跑窗口/断点续跑 .-> H
```

关键变化：配置与日历纳入版本控制；聚合后增加一致性校验点；增量支持重跑窗口与补数。

---

## 对策方向（鱼骨）

```mermaid
mindmap
  root((对策与保障))
    统一口径
      标准时间统一转换接口
      工序/工段字典表统一
      日历/班次版本化
    流程稳健
      增量刷新重跑窗口
      异常告警与自动重试
      手工文件到数校验
    可追溯
      配置变更审计
      数据版本标记与快照
      日志集中化
```

---

## 具体措施（可落地）

- 配置治理
  - 整合配置为“主配置 + 环境覆盖”；建立版本与变更记录。
  - 将日历（工作日/班次/节假日）脚本化生成为统一表。
- 口径统一
  - 标准时间通过统一接口转换，并在 ETL 内统一调用。
  - 建立工序/工段字典表，定期校验异常值并生成报告。
- 刷新稳健
  - 增量刷新加入“重跑窗口”（最近 N 天）与“补数清单”；失败自动重试并告警。
  - 发布前后对样本集进行“DAX 一致性回放”，误差超阈值阻断发布。
- 监控与可观测
  - 统一日志格式与指标；失败/延迟告警，附一键重跑指引。

---

## 预期成效与衡量

- 刷新稳定性：作业失败率 < 1%，平均耗时下降 20%+。
- 数据一致性：与 DAX 定义抽样比对误差 ≤ 0.5%。
- 维护效率：配置改动可追溯、可回滚，减少脚本化变更风险。


