# MDDAP 数据监控面板

这是一个基于 Streamlit 的实时数据监控面板，用于监控 MDDAP 数据库的统计信息和数据质量。

## 功能特性

- 📊 **实时数据统计**: 显示 MES、SFC、SAP 三个数据源的记录数量和关键指标
- 🔍 **数据质量监控**: 监控数据完整性，识别缺失时间戳等数据质量问题
- ⚠️ **异常数据查询**: 提供异常数据的查询和下载功能
- 📈 **时间趋势分析**: 展示近6个月的数据趋势
- 🔄 **自动刷新**: 支持 30-300 秒的自动刷新间隔

## 特殊说明

### SFC TrackInTime 字段
- 2024年10月之前的 SFC 数据中 TrackInTime 缺失是**正常现象**
- 这是因为 TrackInTime 字段是近期才添加到系统中的
- 监控面板会区分历史数据和近期数据的缺失情况

## 安装和运行

### 1. 安装依赖

```bash
cd dashboard
pip install -r requirements.txt
```

### 2. 运行面板

#### 直接运行
```bash
streamlit run app.py
```

### 3. 访问面板

运行后会自动打开浏览器，或访问：
```
http://localhost:8501
```

## 使用指南

### 主要功能页面

1. **数据概览**
   - 显示各数据源的总量和完整性
   - 饼图展示数据完整性比例
   - 关键指标卡片

2. **数据质量**
   - 详细的数据质量统计
   - 区分历史数据和近期数据的缺失情况
   - 数据完整性百分比

3. **异常查询**
   - 可查询缺失时间戳的详细记录
   - 支持下载异常数据为 CSV 文件
   - 分页显示，避免一次加载过多数据

4. **时间趋势**
   - 展示近6个月的数据量趋势
   - MES 和 SFC 数据对比
   - 交互式图表，支持缩放和悬停

### 自动刷新设置

在侧边栏可以：
- 开启/关闭自动刷新
- 选择刷新间隔（30秒、60秒、120秒、300秒）
- 查看最后更新时间

## 技术架构

- **前端**: Streamlit
- **数据可视化**: Plotly
- **数据处理**: Pandas
- **数据库**: SQLite
- **缓存**: 60秒 TTL，避免频繁查询数据库

## 注意事项

1. 确保数据库文件 `mddap_v2.db` 存在且可访问
2. 首次运行可能需要较长时间加载数据
3. 自动刷新功能会增加数据库负载
4. 建议在非生产时间进行大量数据查询

## 故障排除

### 常见问题

1. **数据库连接失败**
   - 检查数据库文件路径是否正确
   - 确认没有其他程序正在使用数据库

2. **页面加载缓慢**
   - 考虑增加缓存时间
   - 减少查询的数据量

3. **图表不显示**
   - 检查是否有数据满足查询条件
   - 查看浏览器控制台错误信息

## 更新日志

- v1.0.0 (2025-12-13): 初始版本发布
  - 基础数据监控功能
  - 数据质量检查
  - 异常数据查询
  - 时间趋势分析
