==========================================================================================
SQL Server vs ETL 引用对照报告
==========================================================================================
SQL Server: localhost\SQLEXPRESS / DB: mddap_v2
Scanned python files: 106
-
SQL objects: tables=24, views=1
Referenced table/view tokens in code: 24

==========================================================================================
A) SQL Server 存在但代码未引用（可疑多余/历史遗留候选）
==========================================================================================
- table: dbo.raw_calendar rows=0
- table: dbo.etl_run_log rows=8

==========================================================================================
B) 代码引用但 SQL Server 中不存在（ETL/命名/迁移可能缺失）
==========================================================================================
(none)

==========================================================================================
C) SQL Server 表存在但行数为 0（可能 ETL 没跑/写入目标不对）
==========================================================================================
- dbo.mes_metrics_snapshot_b rows=0 refs_in_code=1
    - scripts\_refresh_mes_metrics_materialized.py
- dbo.raw_calendar rows=0 refs_in_code=0
- dbo.raw_sfc_inspection rows=0 refs_in_code=2
    - data_pipelines\sources\sfc\etl\etl_sfc_inspection_raw.py
    - scripts\validation\compare_row_counts_dual_db.py

==========================================================================================
D) 仍明显依赖 SQLite/DualDatabaseManager 的脚本（需要确认是否已纯 SQL Server 写入）
==========================================================================================
- data_pipelines\monitoring\etl\etl_alert_engine.py
- data_pipelines\monitoring\etl\etl_kpi_aggregation.py
- data_pipelines\sources\dimension\etl\etl_calendar.py
- data_pipelines\sources\dimension\etl\etl_holidays.py
- data_pipelines\sources\dimension\etl\etl_operation_cleaning.py
- data_pipelines\sources\dimension\etl\etl_operation_mapping.py
- data_pipelines\sources\mes\etl\etl_mes_batch_output_raw.py
- data_pipelines\sources\sap\etl\etl_planned_labor_hours.py
- data_pipelines\sources\sap\etl\etl_sap_labor_hours.py
- data_pipelines\sources\sap\etl\etl_sap_routing_raw.py
- data_pipelines\sources\sap\etl\etl_update_planned_workday.py
- data_pipelines\sources\sfc\etl\etl_sfc_batch_output_raw.py
- data_pipelines\sources\sfc\etl\etl_sfc_inspection_raw.py
- data_pipelines\sources\sfc\etl\etl_sfc_nc.py
- data_pipelines\sources\sfc\etl\etl_sfc_repair.py
- data_pipelines\sources\sfc\etl\etl_sfc_wip_czm.py
- scripts\_clear_sqlite_routing.py
- scripts\_force_reimport_routing.py
- scripts\_temp_check_routing_fields.py
- scripts\_temp_check_routing_match.py
- scripts\_temp_purge_all_mes.py
- scripts\_temp_test_routing_match_fixed.py
- scripts\check_tables.py
- scripts\debug\inspect_db_view.py
- scripts\mes_raw_audit.py
- scripts\migrate\migrate_sqlite_to_sqlserver.py
- scripts\purge_mes_raw_by_year.py
- scripts\refresh_mes_full.py
- scripts\test_mes_raw_etl.py
- scripts\update_db_view.py
- scripts\validation\backfill_sqlserver_from_sqlite.py
- scripts\validation\compare_row_counts_dual_db.py
- scripts\validation\inventory_sqlserver_vs_etl.py
- scripts\validation\verify_sa_calculation.py

==========================================================================================
E) 重点关注（现状推断）
==========================================================================================
- 如果某 raw_/dim_ 表在 SQL Server 行数为 0，同时对应 ETL 脚本仍在用 Dual/SQLite 状态逻辑，通常意味着：
  - ETL 可能写入 SQL Server 失败被吞掉；或
  - ETL 仍以 SQLite 为主，SQL Server 只是 best-effort；或
  - 实际写入表名与 SQL Server 表名不一致（大小写/前缀/历史表）
-
下一步建议：对每个 raw_ 表执行一次对应 ETL，并在 SQL Server 侧检查行数变化，以确认写入链路。
