# KPI 智能触发与 A3 管理系统概览

## 1. 系统简介
本系统是一个自动化的质量与绩效监控平台，旨在通过实时分析 KPI 数据，自动识别异常趋势或未达标情况，并自动触发 A3 问题解决流程。系统打通了数据源、分析引擎与任务管理平台，确保问题被及时发现、及时跟进。

## 2. 核心价值
*   **自动化监控**：7x24 小时监控关键指标，无需人工手动查阅报表。
*   **标准化判定**：基于既定的业务规则（如连续下降、持续排名靠前）统一判定，消除人为判断的随意性。
*   **闭环管理**：从“发现问题”到“立项 A3”再到“分配任务”，全流程数字化闭环，防止问题遗漏。
*   **及时响应**：异常发生后立即推送邮件与 Planner 任务，缩短响应时间。

## 3. 系统工作流
系统主要由四个环节组成：

1.  **数据采集与计算**：
    *   系统定期从 KPI 数据库中读取最新的绩效数据。
    *   后台算法根据预设规则进行计算和判定。
2.  **异常触发 (Trigger)**：
    *   一旦发现满足触发条件（如连续 4 周下降），系统生成一条“触发记录 (Trigger Case)”。
    *   系统会自动去重，避免对同一未解决的问题重复报警。
3.  **可视化展示 (Power BI)**：
    *   管理层可以通过 Power BI 仪表板查看当前的触发状态、历史趋势及未关闭的报警。
4.  **任务推送 (Power Automate & Planner)**：
    *   系统自动在 Microsoft Planner 中创建任务卡片。
    *   同时向相关负责人发送通知邮件，提示“需启动 A3 流程”。

## 4. 触发规则详解
系统目前支持以下四种核心触发逻辑，覆盖了从突发异常到长期趋势的各类场景：

| 触发类型代码 | 中文名称 | 触发逻辑描述 | 适用场景 | 严重程度 |
| :--- | :--- | :--- | :--- | :--- |
| **PERSISTENT_TOP_3** | **连续 4 周 Top 3** | 某项目/区域连续 4 周在不良排名中位于前 3 名 | 识别长期存在的“顽疾”或“老大难”问题 | **High** |
| **TREND_DOWN_4** | **连续 4 周下降** | 指标数值连续 4 周呈现下降趋势（即使当前仍高于目标值） | 识别潜在的恶化趋势，防患于未然 | **Medium** |
| **GOAL_MISSED** | **目标未达** | 指标数值低于设定的目标值（部分指标需连续 4 周未达标才触发） | 监控核心绩效是否达标 | **Medium** |
| **THRESHOLD_EXCEEDED** | **超标预警** | 发生一次即触发（如：重大安全事故次数 > 0） | 零容忍指标的即时报警 | **Critical** |

## 5. 用户交互与操作指南

### 当您收到通知时...
系统会通过 **Outlook 邮件** 和 **Planner 任务** 通知您。

1.  **查看邮件**：
    *   邮件标题通常为：`[KPI Alert] New A3 Trigger Created: A3-2025xxxx - [类别]`
    *   邮件中包含触发的具体原因、近几周的数据详情。
2.  **处理 Planner 任务**：
    *   点击邮件链接进入 Planner。
    *   **Checklist 操作**：
        1.  **Assess trigger**：评估该触发是否有效，排除数据录入错误等干扰因素。
        2.  **Confirm A3 and assign owner**：确认需要启动 A3，并在 Planner 卡片中指派具体的 Owner（负责人）。
3.  **更新 A3 进展**：
    *   线下或在线上进行 A3 问题分析。
    *   问题解决后，在 Planner 中将任务标记为“已完成 (Completed)”。

### 系统运行规则
*   **运行频率**：系统按计划自动运行（如每周一上午）。
*   **任务去重**：如果针对同一个问题（A3 ID 相同）已经存在一个“进行中 (Open)”的任务，系统不会重复创建新任务，避免打扰。

## 6. 技术依赖 (IT 信息)
*   **核心逻辑**：Python 脚本
    *   **数据聚合**: `data_pipelines/monitoring/etl/etl_kpi_aggregation.py` (主要入口，负责计算 KPI 并生成报表)
    *   **监控引擎**: `data_pipelines/monitoring/etl/etl_alert_engine.py` (负责规则检查和触发器生成)
*   **数据库**：SQLite (存储历史数据与触发台账)。
*   **输出文件**:
    *   `kpi_global_matrix.csv`: 全局 KPI 矩阵 (Lead Time, SA)
    *   `pareto_top_matrix.csv`: 安全隐患排名矩阵
    *   `kpi_trigger_results.csv` / `.tsv`: 触发警报详情
*   **可视化**：Microsoft Power BI (展示 CSV/TSV 数据源)。
*   **自动化流**：Power Automate (监控文件更新 -> 自动创建 Planner 任务 -> 发送邮件)。
