# é¡¹ç›®ç»“æ„æŒ‡å—

## ğŸ“š æ–‡æ¡£ç›®çš„

æœ¬æ–‡æ¡£è¯´æ˜æ•°å­—åŒ–æ•°æ®å¹³å°é¡¹ç›®çš„æ ‡å‡†åŒ–ç›®å½•ç»“æ„ã€å„ç›®å½•çš„ç”¨é€”ä»¥åŠä½¿ç”¨æ–¹æ³•ã€‚

**é€‚ç”¨å¯¹è±¡ï¼š** å¼€å‘äººå‘˜ã€æ•°æ®åˆ†æå¸ˆã€é¡¹ç›®ç»´æŠ¤äººå‘˜

**æœ€åæ›´æ–°ï¼š** 2025å¹´12æœˆ9æ—¥

---

## ğŸ—ï¸ é¡¹ç›®ç»“æ„æ€»è§ˆ

```
250418_MDDAP_project/
â”œâ”€â”€ scripts/                    # å·¥å…·è„šæœ¬ä¸­å¿ƒ
â”œâ”€â”€ data_pipelines/             # æ•°æ®ç®¡é“
â”œâ”€â”€ shared_infrastructure/      # å…±äº«åŸºç¡€è®¾æ–½
â”œâ”€â”€ business_domains/           # ä¸šåŠ¡é¢†åŸŸ
â”œâ”€â”€ documentation/              # MkDocsæ–‡æ¡£ç³»ç»Ÿ
â”œâ”€â”€ docs/                       # é¡¹ç›®å¼€å‘æ–‡æ¡£
â”œâ”€â”€ mkdocs.yml                  # MkDocsé…ç½®
â””â”€â”€ .gitignore                  # Gitå¿½ç•¥è§„åˆ™
```

---

## ğŸ“‚ ç›®å½•è¯¦ç»†è¯´æ˜

### 1ï¸âƒ£ `scripts/` - å·¥å…·è„šæœ¬ä¸­å¿ƒ

**ç”¨é€”ï¼š** å­˜æ”¾æ‰€æœ‰å·¥å…·è„šæœ¬ã€è°ƒè¯•è„šæœ¬å’ŒéªŒè¯è„šæœ¬

**å­ç›®å½•ç»“æ„ï¼š**
```
scripts/
â”œâ”€â”€ debug/                      # è°ƒè¯•è„šæœ¬
â”‚   â”œâ”€â”€ debug_mes_import.py
â”‚   â”œâ”€â”€ debug_paths.py
â”‚   â””â”€â”€ ...
â”œâ”€â”€ tools/                      # å·¥å…·è„šæœ¬
â”‚   â”œâ”€â”€ smart_refresh_scheduler.py
â”‚   â”œâ”€â”€ PowerBIå‚æ•°åŒ–æŸ¥è¯¢.m
â”‚   â””â”€â”€ ...
â”œâ”€â”€ validation/                 # éªŒè¯è„šæœ¬
â”‚   â”œâ”€â”€ etl_validate_sa_results.py
â”‚   â”œâ”€â”€ verify_complete_logic.py
â”‚   â””â”€â”€ ...
â””â”€â”€ refresh_core_data.bat     # æ ¸å¿ƒæ•°æ®å¿«é€Ÿåˆ·æ–°è„šæœ¬
â””â”€â”€ refresh_full_data.bat     # å…¨é‡æ•°æ®åˆ·æ–°è„šæœ¬
```

**ä½¿ç”¨æ–¹æ³•ï¼š**
```bash
# ä¸€é”®åˆ·æ–°æ ¸å¿ƒæ•°æ®
.\scripts\refresh_core_data.bat

# è¿è¡ŒéªŒè¯è„šæœ¬
python scripts\validation\etl_validate_sa_results.py

# ä½¿ç”¨æ™ºèƒ½è°ƒåº¦å™¨
python scripts\tools\smart_refresh_scheduler.py
```

---

### 2ï¸âƒ£ `data_pipelines/` - æ•°æ®ç®¡é“

**ç”¨é€”ï¼š** å­˜æ”¾æ‰€æœ‰ETLè„šæœ¬å’Œæ•°æ®å¤„ç†é€»è¾‘

**ç›®å½•ç»“æ„ï¼š**
```
data_pipelines/
â””â”€â”€ sources/
    â”œâ”€â”€ mes/                    # MESæ•°æ®æº
    â”‚   â”œâ”€â”€ etl/               # ETLè„šæœ¬
    â”‚   â”œâ”€â”€ config/            # é…ç½®æ–‡ä»¶
    â”‚   â”œâ”€â”€ state/             # çŠ¶æ€æ–‡ä»¶
    â”‚   â”œâ”€â”€ tests/             # æµ‹è¯•è„šæœ¬
    â”‚   â””â”€â”€ docs/              # æ–‡æ¡£
    â”œâ”€â”€ sfc/                    # SFCæ•°æ®æº
    â”‚   â””â”€â”€ ...
    â””â”€â”€ sap/                    # SAPæ•°æ®æº
        â””â”€â”€ ...
```

**ETLè„šæœ¬å‘½åè§„èŒƒï¼š**
- `etl_dataclean_{source}_{dataset}.py`
- ä¾‹å¦‚ï¼š`etl_dataclean_mes_batch_report.py`

**ä½¿ç”¨æ–¹æ³•ï¼š**
```bash
# è¿è¡Œå•ä¸ªETLè„šæœ¬ï¼ˆå¢é‡æ¨¡å¼ï¼‰
python data_pipelines\sources\mes\etl\etl_dataclean_mes_batch_report.py --mode incremental --unattended

# è¿è¡Œå•ä¸ªETLè„šæœ¬ï¼ˆå…¨é‡æ¨¡å¼ï¼‰
python data_pipelines\sources\mes\etl\etl_dataclean_mes_batch_report.py --mode full --unattended

# æŸ¥çœ‹å¸®åŠ©
python data_pipelines\sources\mes\etl\etl_dataclean_mes_batch_report.py --help
```

---

### 3ï¸âƒ£ `shared_infrastructure/` - å…±äº«åŸºç¡€è®¾æ–½

**ç”¨é€”ï¼š** å­˜æ”¾å…±äº«çš„é…ç½®ã€å·¥å…·å‡½æ•°ã€æ—¥å¿—ç­‰

**ç›®å½•ç»“æ„ï¼š**
```
shared_infrastructure/
â”œâ”€â”€ config/
â”‚   â”œâ”€â”€ paths.yaml             # è·¯å¾„é…ç½®
â”‚   â””â”€â”€ reference_data/        # å‚è€ƒæ•°æ®
â”‚       â”œâ”€â”€ operation_mapping.csv
â”‚       â””â”€â”€ operation_cleaning_result.csv
â”œâ”€â”€ utils/
â”‚   â”œâ”€â”€ etl_utils.py           # ETLå·¥å…·å‡½æ•°
â”‚   â””â”€â”€ path_resolver.py       # è·¯å¾„è§£æå™¨
â”œâ”€â”€ logs/                      # é›†ä¸­æ—¥å¿—
â”‚   â”œâ”€â”€ etl_mes.log
â”‚   â”œâ”€â”€ etl_sfc.log
â”‚   â””â”€â”€ etl_sap.log
â””â”€â”€ tests/                     # å…±äº«æµ‹è¯•
```

**å…³é”®æ–‡ä»¶è¯´æ˜ï¼š**

**`paths.yaml`** - è·¯å¾„é…ç½®æ–‡ä»¶
```yaml
# å®šä¹‰å„æ¨¡å—çš„ç›¸å¯¹è·¯å¾„
shared_infrastructure_paths:
  config: "../../../shared-infrastructure/config"
  utils: "../../../shared-infrastructure/utils"
  logs: "../../../shared-infrastructure/logs"
```

**`etl_utils.py`** - ETLå·¥å…·å‡½æ•°åº“
- `setup_logging()` - æ—¥å¿—è®¾ç½®
- `load_config()` - é…ç½®åŠ è½½
- `save_to_parquet()` - ä¿å­˜Parquetæ–‡ä»¶
- `update_etl_state()` - æ›´æ–°ETLçŠ¶æ€
- ç­‰ç­‰...

**ä½¿ç”¨æ–¹æ³•ï¼š**
```python
# åœ¨ETLè„šæœ¬ä¸­å¯¼å…¥å…±äº«å·¥å…·
from shared_infrastructure.utils.etl_utils import (
    setup_logging,
    load_config,
    save_to_parquet
)

# ä½¿ç”¨PathResolverè§£æè·¯å¾„
from shared_infrastructure.utils.path_resolver import PathResolver
resolver = PathResolver()
config_path = resolver.get_path('config')
```

---

### 4ï¸âƒ£ `business_domains/` - ä¸šåŠ¡é¢†åŸŸ

**ç”¨é€”ï¼š** æŒ‰ä¸šåŠ¡éƒ¨é—¨ç»„ç»‡æµ‹è¯•æ•°æ®å’Œè¾“å‡ºæ•°æ®

**ç›®å½•ç»“æ„ï¼š**
```
business_domains/
â”œâ”€â”€ quality-dept/              # è´¨é‡éƒ¨é—¨
â”‚   â””â”€â”€ test-data/
â”œâ”€â”€ production-dept/           # ç”Ÿäº§éƒ¨é—¨
â”‚   â””â”€â”€ test-data/
â”œâ”€â”€ finance-dept/              # è´¢åŠ¡éƒ¨é—¨
â”‚   â””â”€â”€ test-data/
â””â”€â”€ ci-dept/                   # CIéƒ¨é—¨
    â””â”€â”€ test-data/
```

**æ•°æ®æºåˆ°éƒ¨é—¨çš„æ˜ å°„ï¼š**
- `sfc` â†’ `quality-dept`
- `mes` â†’ `production-dept`
- `sap` â†’ `finance-dept`, `production-dept`, `supply-chain-dept`

---

### 5ï¸âƒ£ `documentation/` - MkDocsæ–‡æ¡£ç³»ç»Ÿ

**ç”¨é€”ï¼š** ç”¨æˆ·æ–‡æ¡£å’ŒæŠ€æœ¯æ–‡æ¡£çš„MkDocsæºæ–‡ä»¶

**ç›®å½•ç»“æ„ï¼š**
```
documentation/
â”œâ”€â”€ docs/
â”‚   â”œâ”€â”€ technical/             # æŠ€æœ¯æ–‡æ¡£
â”‚   â”‚   â”œâ”€â”€ SA_LTæŒ‡æ ‡è®¡ç®—è¯´æ˜.html
â”‚   â”‚   â”œâ”€â”€ SFCè®¡ç®—é€»è¾‘æ¢³ç†.md
â”‚   â”‚   â”œâ”€â”€ MESæ•°æ®åˆ†å±‚æ¶æ„è®¾è®¡æ–¹æ¡ˆ.md
â”‚   â”‚   â””â”€â”€ PowerBIå¢é‡åˆ·æ–°å®Œæ•´è§£å†³æ–¹æ¡ˆ.md
â”‚   â”œâ”€â”€ project/               # é¡¹ç›®æ–‡æ¡£
â”‚   â”‚   â”œâ”€â”€ 20250520ç¬¬ä¸€æ¬¡ä¼šè®®çºªè¦.md
â”‚   â”‚   â””â”€â”€ 01_ProjectPresentation_é¡¹ç›®å±•ç¤º.md
â”‚   â”œâ”€â”€ etl/                   # ETLæ–‡æ¡£
â”‚   â”œâ”€â”€ kpi/                   # KPIæ–‡æ¡£
â”‚   â””â”€â”€ ...
â”œâ”€â”€ reference/                 # å‚è€ƒèµ„æ–™
â”‚   â”œâ”€â”€ 01_æ–‡ä»¶å‘½åè§„èŒƒ.md
â”‚   â””â”€â”€ å­—å…¸è¡¨ç”¨æ³•ä¸ä»‹ç».md
â”œâ”€â”€ requirements.txt           # Pythonä¾èµ–
â””â”€â”€ *.bat                      # æ–‡æ¡£éƒ¨ç½²è„šæœ¬
```

**ä½¿ç”¨æ–¹æ³•ï¼š**
```bash
# æœ¬åœ°é¢„è§ˆæ–‡æ¡£
cd documentation
.\å¯åŠ¨æ–‡æ¡£æœåŠ¡_ä¿®å¤ç‰ˆ.bat

# æˆ–è€…ä»é¡¹ç›®æ ¹ç›®å½•
mkdocs serve

# ç”Ÿæˆé™æ€ç½‘ç«™
cd documentation
.\ç”Ÿæˆé™æ€ç½‘ç«™.bat

# æˆ–è€…ä»é¡¹ç›®æ ¹ç›®å½•
mkdocs build
```

**è®¿é—®åœ°å€ï¼š** http://127.0.0.1:8000/

---

### 6ï¸âƒ£ `docs/` - é¡¹ç›®å¼€å‘æ–‡æ¡£

**ç”¨é€”ï¼š** å­˜æ”¾é¡¹ç›®å¼€å‘ç›¸å…³çš„æŠ€æœ¯æ–‡æ¡£å’Œè¿ç§»æŠ¥å‘Š

**ç›®å½•ç»“æ„ï¼š**
```
docs/
â”œâ”€â”€ archives/                  # æŠ€æœ¯æŠ¥å‘Šå½’æ¡£
â”‚   â”œâ”€â”€ COMPLETE_LOGIC_FINAL_REPORT.md
â”‚   â”œâ”€â”€ PT_CALCULATION_FIX.md
â”‚   â””â”€â”€ ...
â”œâ”€â”€ MIGRATION_PLAN.md          # è¿ç§»è®¡åˆ’
â”œâ”€â”€ validation_progress.yaml   # éªŒè¯è¿›åº¦
â”œâ”€â”€ PHASE_2_ETL_MIGRATION_SUMMARY.md
â”œâ”€â”€ PHASE_3_FILE_ORGANIZATION_SUMMARY.md
â”œâ”€â”€ PHASE_3.5_SCRIPTS_ORGANIZATION_SUMMARY.md
â”œâ”€â”€ PHASE_4_FINAL_CLEANUP_SUMMARY.md
â”œâ”€â”€ PROJECT_STRUCTURE_GUIDE.md  # æœ¬æ–‡æ¡£
â””â”€â”€ ETL_MIGRATION_TEMPLATE.md
```

**æ–‡æ¡£ç±»å‹ï¼š**
- **PhaseæŠ¥å‘Šï¼š** å„é˜¶æ®µè¿ç§»å’Œæ•´ç†çš„æ€»ç»“
- **æŠ€æœ¯æŠ¥å‘Šï¼š** å½’æ¡£çš„ä¿®å¤å’Œä¼˜åŒ–æŠ¥å‘Š
- **æŒ‡å—æ–‡æ¡£ï¼š** é¡¹ç›®ç»“æ„ã€è¿ç§»æ¨¡æ¿ç­‰

---

### 7ï¸âƒ£ `mkdocs.yml` - MkDocsé…ç½®

**ç”¨é€”ï¼š** MkDocsæ–‡æ¡£ç³»ç»Ÿçš„ä¸»é…ç½®æ–‡ä»¶

**å…³é”®é…ç½®ï¼š**
```yaml
site_name: å¸¸å·å›­åŒºæ•°å­—åŒ–æ•°æ®å¹³å°
docs_dir: documentation/docs    # æ–‡æ¡£æºç›®å½•
site_dir: site                  # ç”Ÿæˆçš„é™æ€ç½‘ç«™ç›®å½•
```

---

### 8ï¸âƒ£ `.gitignore` - Gitå¿½ç•¥è§„åˆ™

**ç”¨é€”ï¼š** å®šä¹‰Gitç‰ˆæœ¬æ§åˆ¶å¿½ç•¥çš„æ–‡ä»¶å’Œç›®å½•

**å…³é”®å¿½ç•¥é¡¹ï¼š**
```
# Python
__pycache__/
*.pyc
.venv/

# MkDocsç”Ÿæˆå†…å®¹
site/

# æ—¥å¿—
*.log
logs/

# ä¸´æ—¶æ–‡ä»¶
*.tmp
.cache/
```

---

## ğŸ”§ å¸¸ç”¨æ“ä½œæŒ‡å—

### æ•°æ®åˆ·æ–°æ“ä½œ

**ä¸€é”®åˆ·æ–°æ ¸å¿ƒæ•°æ®ï¼š**
```bash
.\scripts\refresh_core_data.bat
```

**åˆ·æ–°å•ä¸ªæ•°æ®æºï¼š**
```bash
# MESæ•°æ®
python data_pipelines\sources\mes\etl\etl_dataclean_mes_batch_report.py --mode incremental --unattended

# SFCæ•°æ®
python data_pipelines\sources\sfc\etl\etl_dataclean_sfc_team_passrate.py --mode incremental --unattended

# SAPæ•°æ®
python data_pipelines\sources\sap\etl\etl_dataclean_sap_routing.py --mode incremental --unattended
```

### æ–‡æ¡£æ“ä½œ

**é¢„è§ˆæ–‡æ¡£ï¼š**
```bash
mkdocs serve
```

**ç”Ÿæˆé™æ€ç½‘ç«™ï¼š**
```bash
mkdocs build
```

**éƒ¨ç½²åˆ°GitHub Pagesï¼š**
```bash
cd documentation
.\éƒ¨ç½²åˆ°GitHub.bat
```

### è°ƒè¯•å’ŒéªŒè¯

**è¿è¡Œè°ƒè¯•è„šæœ¬ï¼š**
```bash
python scripts\debug\debug_mes_import.py
```

**è¿è¡ŒéªŒè¯è„šæœ¬ï¼š**
```bash
python scripts\validation\etl_validate_sa_results.py
```

### æŸ¥çœ‹æ—¥å¿—

**æ—¥å¿—ä½ç½®ï¼š**
```
shared_infrastructure/logs/
â”œâ”€â”€ etl_mes.log
â”œâ”€â”€ etl_sfc.log
â””â”€â”€ etl_sap.log
```

**æŸ¥çœ‹æ—¥å¿—ï¼š**
```bash
# PowerShell
Get-Content shared_infrastructure\logs\etl_mes.log -Tail 50

# æˆ–ä½¿ç”¨æ–‡æœ¬ç¼–è¾‘å™¨æ‰“å¼€
```

---

## ğŸ“‹ æ–‡ä»¶å‘½åè§„èŒƒ

### ETLè„šæœ¬å‘½å
- **æ ¼å¼ï¼š** `etl_dataclean_{source}_{dataset}.py`
- **ç¤ºä¾‹ï¼š** `etl_dataclean_mes_batch_report.py`

### é…ç½®æ–‡ä»¶å‘½å
- **æ ¼å¼ï¼š** `config_{source}_{dataset}.yaml`
- **ç¤ºä¾‹ï¼š** `config_mes_batch_report.yaml`

### çŠ¶æ€æ–‡ä»¶å‘½å
- **æ ¼å¼ï¼š** `{source}_{dataset}_state.json`
- **ç¤ºä¾‹ï¼š** `mes_batch_report_state.json`

### æ—¥å¿—æ–‡ä»¶å‘½å
- **æ ¼å¼ï¼š** `etl_{source}.log`
- **ç¤ºä¾‹ï¼š** `etl_mes.log`

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### æ–°å¼€å‘äººå‘˜å…¥é—¨

1. **å…‹éš†é¡¹ç›®**
   ```bash
   git clone <repository_url>
   cd 250418_MDDAP_project
   ```

2. **è®¾ç½®è™šæ‹Ÿç¯å¢ƒ**
   ```bash
   python -m venv .venv
   .venv\Scripts\activate
   ```

3. **å®‰è£…ä¾èµ–**
   ```bash
   pip install -r documentation\requirements.txt
   ```

4. **æµ‹è¯•æ•°æ®åˆ·æ–°**
   ```bash
   .\scripts\refresh_core_data.bat
   ```

5. **é¢„è§ˆæ–‡æ¡£**
   ```bash
   mkdocs serve
   ```

### æ·»åŠ æ–°çš„ETLè„šæœ¬

1. **åˆ›å»ºETLè„šæœ¬**
   - ä½ç½®ï¼š`data_pipelines/sources/{source}/etl/`
   - å‘½åï¼š`etl_dataclean_{source}_{dataset}.py`

2. **åˆ›å»ºé…ç½®æ–‡ä»¶**
   - ä½ç½®ï¼š`data_pipelines/sources/{source}/config/`
   - å‘½åï¼š`config_{source}_{dataset}.yaml`

3. **ä½¿ç”¨å…±äº«å·¥å…·**
   ```python
   from shared_infrastructure.utils.etl_utils import (
       setup_logging,
       load_config,
       save_to_parquet
   )
   from shared_infrastructure.utils.path_resolver import PathResolver
   ```

4. **æ›´æ–°ä¸€é”®åˆ·æ–°è„šæœ¬**
   - ç¼–è¾‘ï¼š`scripts/refresh_core_data.bat`
   - æ·»åŠ æ–°çš„ETLè„šæœ¬è°ƒç”¨

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- **Phase 2 ETLè¿ç§»æ€»ç»“ï¼š** `docs/PHASE_2_ETL_MIGRATION_SUMMARY.md`
- **Phase 3 æ–‡ä»¶æ•´ç†æ€»ç»“ï¼š** `docs/PHASE_3_FILE_ORGANIZATION_SUMMARY.md`
- **Phase 3.5 è„šæœ¬æ•´ç†æ€»ç»“ï¼š** `docs/PHASE_3.5_SCRIPTS_ORGANIZATION_SUMMARY.md`
- **Phase 4 æœ€ç»ˆæ¸…ç†æ€»ç»“ï¼š** `docs/PHASE_4_FINAL_CLEANUP_SUMMARY.md`
- **ETLè¿ç§»æ¨¡æ¿ï¼š** `docs/ETL_MIGRATION_TEMPLATE.md`

---

## ğŸ†˜ å¸¸è§é—®é¢˜

### Q: å¦‚ä½•æ‰¾åˆ°æŸä¸ªåŠŸèƒ½çš„è„šæœ¬ï¼Ÿ
A: å‚è€ƒæœ¬æ–‡æ¡£çš„ç›®å½•ç»“æ„è¯´æ˜ï¼ŒæŒ‰åŠŸèƒ½åˆ†ç±»æŸ¥æ‰¾ï¼š
- æ•°æ®åˆ·æ–° â†’ `scripts/refresh_core_data.bat`
- ETLè„šæœ¬ â†’ `data_pipelines/sources/{source}/etl/`
- è°ƒè¯•å·¥å…· â†’ `scripts/debug/`
- éªŒè¯å·¥å…· â†’ `scripts/validation/`

### Q: æ—¥å¿—æ–‡ä»¶åœ¨å“ªé‡Œï¼Ÿ
A: æ‰€æœ‰æ—¥å¿—é›†ä¸­åœ¨ `shared_infrastructure/logs/` ç›®å½•

### Q: å¦‚ä½•æ·»åŠ æ–°çš„æ•°æ®æºï¼Ÿ
A: 
1. åœ¨ `data_pipelines/sources/` ä¸‹åˆ›å»ºæ–°çš„æ•°æ®æºç›®å½•
2. æŒ‰ç…§æ ‡å‡†ç»“æ„åˆ›å»ºå­ç›®å½•ï¼ˆetl, config, state, tests, docsï¼‰
3. ç¼–å†™ETLè„šæœ¬ï¼Œä½¿ç”¨å…±äº«å·¥å…·å‡½æ•°
4. æ›´æ–°ä¸€é”®åˆ·æ–°è„šæœ¬

### Q: é…ç½®æ–‡ä»¶åœ¨å“ªé‡Œï¼Ÿ
A: 
- å…¨å±€é…ç½®ï¼š`shared_infrastructure/config/paths.yaml`
- ETLé…ç½®ï¼š`data_pipelines/sources/{source}/config/`

---

## ğŸ“ è”ç³»æ–¹å¼

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·è”ç³»é¡¹ç›®ç»´æŠ¤å›¢é˜Ÿã€‚

---

*æœ¬æ–‡æ¡£æœ€åæ›´æ–°ï¼š2025å¹´12æœˆ9æ—¥*
*é¡¹ç›®æ¶æ„ç‰ˆæœ¬ï¼šPhase 4 (æ ‡å‡†åŒ–å®Œæˆ)*
