# ETLè„šæœ¬è¿ç§»æ¨¡æ¿å’Œæ£€æŸ¥æ¸…å•

## ğŸ“‹ è¿ç§»å‰å‡†å¤‡

### ç¯å¢ƒæ£€æŸ¥
- [ ] ç¡®è®¤é¡¹ç›®æ ¹ç›®å½•ç»“æ„æ­£ç¡®
- [ ] éªŒè¯`shared_infrastructure`æ¨¡å—å¯å¯¼å…¥
- [ ] æ£€æŸ¥`PathResolver`ç±»æ­£å¸¸å·¥ä½œ
- [ ] ç¡®è®¤ç›®æ ‡æ•°æ®æºç›®å½•å­˜åœ¨ (`data_pipelines/sources/{source}/`)

### æ–‡ä»¶æ¸…å•
- [ ] è¯†åˆ«éœ€è¦è¿ç§»çš„ETLè„šæœ¬æ–‡ä»¶
- [ ] è¯†åˆ«ç›¸å…³çš„é…ç½®æ–‡ä»¶ (`.yaml`)
- [ ] è®°å½•å½“å‰ç¡¬ç¼–ç è·¯å¾„å¼•ç”¨
- [ ] å¤‡ä»½åŸå§‹æ–‡ä»¶

---

## ğŸ”§ æ ‡å‡†åŒ–è¿ç§»æ­¥éª¤

### ç¬¬1æ­¥ï¼šæ›´æ–°å¯¼å…¥è¯­å¥

**æ›¿æ¢æ¨¡å¼ï¼š**
```python
# æ—§æ¨¡å¼
import sys
sys.path.append(os.path.dirname(__file__))
from etl_utils import setup_logging, load_config

# æ–°æ¨¡å¼
import sys
import os

# åŠ¨æ€æ·»åŠ é¡¹ç›®æ ¹ç›®å½•åˆ°Pythonè·¯å¾„
current_dir = os.path.dirname(os.path.abspath(__file__))
project_root = os.path.dirname(os.path.dirname(os.path.dirname(current_dir)))
sys.path.insert(0, project_root)

# å¯¼å…¥å…±äº«åŸºç¡€è®¾æ–½å·¥å…·å‡½æ•°
from shared_infrastructure.utils.etl_utils import (
    setup_logging,
    load_config,
    save_to_parquet,
    read_sharepoint_excel
)
from shared_infrastructure.utils.path_resolver import (
    get_config_path,
    get_log_path,
    get_state_path,
    get_path_resolver
)
```

**æ£€æŸ¥æ¸…å•ï¼š**
- [ ] æ·»åŠ åŠ¨æ€é¡¹ç›®æ ¹ç›®å½•åˆ°sys.path
- [ ] æ›´æ–°æ‰€æœ‰etl_utilså¯¼å…¥ä¸ºç»å¯¹å¯¼å…¥
- [ ] æ·»åŠ path_resolverå¯¼å…¥
- [ ] ç§»é™¤æ—§çš„ç›¸å¯¹å¯¼å…¥è¯­å¥

### ç¬¬2æ­¥ï¼šé…ç½®è·¯å¾„å˜é‡

**æ ‡å‡†æ¨¡å¼ï¼š**
```python
# è·å–è·¯å¾„è§£æå™¨
resolver = get_path_resolver()

# é…ç½®è·¯å¾„
CONFIG_PATH = get_config_path("script_name", "source", os.path.dirname(os.path.abspath(__file__)))
LOG_PATH = get_log_path("source")
STATE_PATH = get_state_path("script_name", "source", os.path.dirname(os.path.abspath(__file__)))

# åŸºç¡€ç›®å½•ï¼ˆç”¨äºåŠ¨æ€è·¯å¾„è§£æï¼‰
BASE_DIR = os.path.dirname(os.path.abspath(__file__))
```

**æ£€æŸ¥æ¸…å•ï¼š**
- [ ] è·å–PathResolverå®ä¾‹
- [ ] é…ç½®CONFIG_PATHä½¿ç”¨get_config_path
- [ ] é…ç½®LOG_PATHä½¿ç”¨get_log_path
- [ ] é…ç½®STATE_PATHä½¿ç”¨get_state_path
- [ ] ä¿ç•™BASE_DIRç”¨äºåŠ¨æ€è¿è¡Œæ—¶è·¯å¾„

### ç¬¬3æ­¥ï¼šç§»é™¤é‡å¤å‡½æ•°

**éœ€è¦ç§»é™¤çš„å‡½æ•°ï¼š**
- [ ] `setup_logging()` - ä½¿ç”¨shared_infrastructureç‰ˆæœ¬
- [ ] `load_config()` - ä½¿ç”¨shared_infrastructureç‰ˆæœ¬
- [ ] `read_sharepoint_excel()` - ä½¿ç”¨shared_infrastructureç‰ˆæœ¬
- [ ] å…¶ä»–å·²è¿ç§»åˆ°etl_utilsçš„å‡½æ•°

**æ£€æŸ¥æ¸…å•ï¼š**
- [ ] ç§»é™¤æ‰€æœ‰é‡å¤çš„å‡½æ•°å®šä¹‰
- [ ] ç¡®ä¿å‡½æ•°è°ƒç”¨ä»ç„¶æ­£ç¡®
- [ ] éªŒè¯å¯¼å…¥çš„å‡½æ•°è¦†ç›–æ‰€æœ‰éœ€æ±‚

### ç¬¬4æ­¥ï¼šæ›´æ–°ç¡¬ç¼–ç è·¯å¾„

**éœ€è¦æ›´æ–°çš„è·¯å¾„ç±»å‹ï¼š**
- [ ] é…ç½®æ–‡ä»¶è·¯å¾„ (`../03_é…ç½®æ–‡ä»¶/config/`)
- [ ] æ—¥å¿—æ–‡ä»¶è·¯å¾„ (`../06_æ—¥å¿—æ–‡ä»¶/`)
- [ ] çŠ¶æ€æ–‡ä»¶è·¯å¾„ (`state/`)
- [ ] è¾“å‡ºç›®å½•è·¯å¾„ (`../05_æ•°æ®æ–‡ä»¶/`)
- [ ] æ•°æ®æ¨¡æ¿è·¯å¾„ (`../11æ•°æ®æ¨¡æ¿/`)

**æ›´æ–°æ¨¡å¼ï¼š**
```python
# æ—§æ¨¡å¼
CONFIG_PATH = os.path.join(BASE_DIR, "..", "03_é…ç½®æ–‡ä»¶", "config", "config_script.yaml")
log_file = cfg.get("logging", {}).get("file", "../06_æ—¥å¿—æ–‡ä»¶/script.log")
state_file = os.path.join(BASE_DIR, "state/script_state.json")

# æ–°æ¨¡å¼
CONFIG_PATH = get_config_path("script_name", "source", os.path.dirname(os.path.abspath(__file__)))
# log_fileåœ¨é…ç½®ä¸­å¤„ç†ï¼Œæˆ–ä½¿ç”¨LOG_PATH
STATE_PATH = get_state_path("script_name", "source", os.path.dirname(os.path.abspath(__file__)))
```

### ç¬¬5æ­¥ï¼šæ›´æ–°argparseé»˜è®¤å€¼

**æ£€æŸ¥æ¸…å•ï¼š**
- [ ] æŸ¥æ‰¾æ‰€æœ‰argparse.ArgumentParserå®ä¾‹
- [ ] æ›´æ–°--configå‚æ•°é»˜è®¤å€¼ä¸ºCONFIG_PATHå˜é‡
- [ ] æ›´æ–°å…¶ä»–ç¡¬ç¼–ç è·¯å¾„çš„é»˜è®¤å€¼
- [ ] ä¿æŒç›¸å¯¹è·¯å¾„ç”¨äºé…ç½®æ–‡ä»¶ä¸­çš„åŠ¨æ€è·¯å¾„

---

## ğŸ“ é…ç½®æ–‡ä»¶è¿ç§»

### ç§»åŠ¨é…ç½®æ–‡ä»¶
**ç›®æ ‡ç›®å½•ï¼š** `data_pipelines/sources/{source}/config/`

**æ£€æŸ¥æ¸…å•ï¼š**
- [ ] ç§»åŠ¨é…ç½®æ–‡ä»¶åˆ°æ–°ç›®å½•
- [ ] æ›´æ–°paths.yamlæ·»åŠ æ–°é…ç½®è·¯å¾„
- [ ] éªŒè¯é…ç½®æ–‡ä»¶å†…å®¹æ­£ç¡®
- [ ] æµ‹è¯•é…ç½®æ–‡ä»¶åŠ è½½

### æ›´æ–°paths.yaml
**æ·»åŠ é…ç½®ï¼š**
```yaml
config_paths:
  script_name: ../config/config_script.yaml

state_paths:
  script_name: ../state/script_state.json
```

---

## ğŸ§ª æµ‹è¯•éªŒè¯

### åˆ›å»ºæµ‹è¯•è„šæœ¬
**æ ‡å‡†æµ‹è¯•æ¨¡æ¿ï¼š**
```python
def test_{source}_script_import():
    """æµ‹è¯•è„šæœ¬å¯¼å…¥æ˜¯å¦æ­£å¸¸"""
    
def test_{source}_path_resolution():
    """æµ‹è¯•è·¯å¾„è§£ææ˜¯å¦æ­£ç¡®"""
    
def test_{source}_script_functionality():
    """æµ‹è¯•åŸºæœ¬åŠŸèƒ½æ˜¯å¦æ­£å¸¸"""
```

**æ£€æŸ¥æ¸…å•ï¼š**
- [ ] åˆ›å»ºæµ‹è¯•è„šæœ¬æ–‡ä»¶
- [ ] å®ç°å¯¼å…¥æµ‹è¯•
- [ ] å®ç°è·¯å¾„è§£ææµ‹è¯•
- [ ] å®ç°åŠŸèƒ½æµ‹è¯•
- [ ] éªŒè¯æ‰€æœ‰æµ‹è¯•é€šè¿‡

### è¿è¡Œæµ‹è¯•
**éªŒè¯æ­¥éª¤ï¼š**
- [ ] è¿è¡Œå¯¼å…¥æµ‹è¯• - åº”è¯¥æˆåŠŸå¯¼å…¥
- [ ] è¿è¡Œè·¯å¾„è§£ææµ‹è¯• - è·¯å¾„åº”è¯¥æ­£ç¡®è§£æ
- [ ] è¿è¡ŒåŠŸèƒ½æµ‹è¯• - é…ç½®åŠ è½½å’Œæ—¥å¿—è®¾ç½®åº”è¯¥æˆåŠŸ
- [ ] æ£€æŸ¥æµ‹è¯•é€šè¿‡ç‡ - åº”è¯¥100%é€šè¿‡

---

## ğŸ” æœ€ç»ˆéªŒè¯

### ä»£ç è´¨é‡æ£€æŸ¥
- [ ] æ£€æŸ¥å‰©ä½™ç¡¬ç¼–ç è·¯å¾„ (`grep "../03_é…ç½®"`)
- [ ] éªŒè¯æ‰€æœ‰å¯¼å…¥è¯­å¥æ­£ç¡®
- [ ] ç¡®è®¤æ²¡æœ‰è¯­æ³•é”™è¯¯
- [ ] æ£€æŸ¥ä»£ç é£æ ¼ä¸€è‡´æ€§

### åŠŸèƒ½éªŒè¯
- [ ] è¿è¡Œè„šæœ¬--helpæµ‹è¯•
- [ ] éªŒè¯é…ç½®æ–‡ä»¶æ­£ç¡®åŠ è½½
- [ ] ç¡®è®¤æ—¥å¿—æ–‡ä»¶æ­£ç¡®åˆ›å»º
- [ ] æµ‹è¯•åŸºæœ¬æ•°æ®å¤„ç†æµç¨‹

---

## ğŸ“ å¸¸è§é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ

### å¯¼å…¥é”™è¯¯
**é—®é¢˜ï¼š** ImportError: No module named 'shared_infrastructure'
**è§£å†³ï¼š** æ£€æŸ¥é¡¹ç›®æ ¹ç›®å½•æ˜¯å¦æ­£ç¡®æ·»åŠ åˆ°sys.path

### è·¯å¾„è§£æé”™è¯¯
**é—®é¢˜ï¼š** é…ç½®æ–‡ä»¶è·¯å¾„è§£æé”™è¯¯
**è§£å†³ï¼š** ç¡®è®¤get_config_pathçš„base_dirå‚æ•°æ­£ç¡®

### é‡å¤å‡½æ•°å†²çª
**é—®é¢˜ï¼š** å‡½æ•°é‡å¤å®šä¹‰å¯¼è‡´çš„å†²çª
**è§£å†³ï¼š** ç§»é™¤ETLè„šæœ¬ä¸­çš„é‡å¤å‡½æ•°å®šä¹‰

### argparseé»˜è®¤å€¼é”™è¯¯
**é—®é¢˜ï¼š** å‘½ä»¤è¡Œå‚æ•°é»˜è®¤å€¼ä½¿ç”¨æ—§è·¯å¾„
**è§£å†³ï¼š** æ›´æ–°é»˜è®¤å€¼ä¸ºè¿ç§»åçš„CONFIG_PATHå˜é‡

---

## ğŸ“Š è¿ç§»å®Œæˆæ£€æŸ¥æ¸…å•

### æ–‡ä»¶è¿ç§»
- [ ] ETLè„šæœ¬æ–‡ä»¶å·²è¿ç§»
- [ ] é…ç½®æ–‡ä»¶å·²ç§»åŠ¨åˆ°æ–°ä½ç½®
- [ ] æµ‹è¯•è„šæœ¬å·²åˆ›å»º
- [ ] æ–‡æ¡£å·²æ›´æ–°

### åŠŸèƒ½éªŒè¯
- [ ] æ‰€æœ‰æµ‹è¯•é€šè¿‡ (3/3)
- [ ] è„šæœ¬å¯¼å…¥æ­£å¸¸
- [ ] è·¯å¾„è§£ææ­£ç¡®
- [ ] åŸºæœ¬åŠŸèƒ½æ­£å¸¸

### ä»£ç è´¨é‡
- [ ] æ— ç¡¬ç¼–ç è·¯å¾„æ®‹ç•™
- [ ] å¯¼å…¥è¯­å¥æ ‡å‡†åŒ–
- [ ] ä»£ç é£æ ¼ä¸€è‡´
- [ ] æ³¨é‡Šå’Œæ–‡æ¡£å®Œæ•´

---

## ğŸš€ è¿ç§»åä»»åŠ¡

### æ–‡æ¡£æ›´æ–°
- [ ] æ›´æ–°é¡¹ç›®æ–‡æ¡£
- [ ] è®°å½•è¿ç§»å†³ç­–
- [ ] æ›´æ–°ä½¿ç”¨è¯´æ˜

### éƒ¨ç½²å‡†å¤‡
- [ ] éªŒè¯ç”Ÿäº§ç¯å¢ƒå…¼å®¹æ€§
- [ ] å‡†å¤‡å›æ»šè®¡åˆ’
- [ ] æ›´æ–°éƒ¨ç½²è„šæœ¬

---

**æ¨¡æ¿ç‰ˆæœ¬ï¼š** v1.0  
**æœ€åæ›´æ–°ï¼š** 2025å¹´12æœˆ3æ—¥  
**é€‚ç”¨èŒƒå›´ï¼š** æ‰€æœ‰ETLè„šæœ¬è¿ç§»é¡¹ç›®
