# 文档治理规则（Docs Governance Rules）

## 目标

- 本文件用于统一项目文档的存放位置、命名方式与更新流程。
- **后续人类与 AI 的所有文档新增/更新都必须遵循本规则**，避免重复文档、路径分裂、口径不一致。

---

## 1. 唯一权威文档目录（Single Source of Truth）

- **权威目录**：`/docs`
  - 任何“仍在维护、需要被检索、需要被引用”的文档，必须放在 `docs/` 下。
- **非权威目录（禁止新增内容）**：
  - `documentation/`：仅保留历史内容或过渡期兼容链接，禁止继续新增/维护同类文档。
  - `archived file/`：历史归档，只读，不作为入口，不持续维护。

> 规则：如果发现 `docs/` 与其它目录存在重复主题文档，以 `docs/` 为准，其它目录只保留“迁移提示/指路页”。

---

## 2. 文档结构约定（Docs Structure）

`docs/` 内按“用户 → 技术 → 管理 → 归档 → 参考”的结构组织。

### 规则：目录（文件夹）统一使用英文

- 目录名必须使用英文（建议使用小写 + 下划线）。
- 文档文件名可使用中文或英文，但需要清晰表达含义。

### 推荐目录结构（权威）

- `docs/01_user_guide/`
  - 面向使用者：怎么运行、怎么刷新、怎么排查。
- `docs/02_technical/`
  - 面向开发者：架构、数据库、ETL、KPI 计算逻辑。
- `docs/03_project_management/`
  - 计划、里程碑、会议纪要等。
- `docs/04_reports_archive/`
  - 验证报告、性能报告、阶段总结等（只读为主，按日期版本）。
- `docs/05_reference/`
  - 模板、工具说明、规范类文档。

### 迁移映射（当前中文目录 → 新英文目录）

说明：左侧为历史目录名（仅用于迁移与兼容），后续新增内容不得使用中文目录名。

| 当前目录 | 新目录 |
|---|---|
| `docs/01_用户文档/` | `docs/01_user_guide/` |
| `docs/02_技术文档/` | `docs/02_technical/` |
| `docs/02_技术文档/开发指南/` | `docs/02_technical/dev_guide/` |
| `docs/02_技术文档/系统架构/` | `docs/02_technical/architecture/` |
| `docs/02_技术文档/运维手册/` | `docs/02_technical/operations/` |
| `docs/03_项目管理/` | `docs/03_project_management/` |
| `docs/04_报告归档/` | `docs/04_reports_archive/` |
| `docs/04_报告归档/阶段总结/` | `docs/04_reports_archive/phase_summary/` |
| `docs/04_报告归档/历史文档/` | `docs/04_reports_archive/historical_docs/` |
| `docs/04_报告归档/优化报告/` | `docs/04_reports_archive/optimization_reports/` |
| `docs/05_参考资料/` | `docs/05_reference/` |
| `docs/05_参考资料/工具说明/` | `docs/05_reference/tools/` |
| `docs/05_参考资料/模板/` | `docs/05_reference/templates/` |

---

## 3. 命名与写作规范

### 3.1 文件命名

- 优先使用**清晰的中文标题**或英文标题（任选其一，重点是可读性）。
- 报告/阶段总结类文档建议包含日期版本：`xxx_YYYYMMDD.md`。
- 避免特殊字符（如 `:` `*` `?` 等）。

### 3.2 字段/表命名

- **数据库表/字段必须使用英文**（中文解释写在文档中）。
- 文档中提到表字段时使用反引号，例如：`raw_mes.TrackOutTime`。

### 3.3 链接规则

- 文档之间使用**相对路径链接**，避免硬编码绝对路径。
- 新增重要文档后，需要在 `docs/README.md`（文档中心）中增加入口链接。

---

## 4. 变更触发的文档同步清单（Change → Docs）

> 原则：**代码变更必须带来文档变更**，尤其是 ETL、数据库结构与 KPI 计算逻辑。

### 4.1 ETL 流程变更

- 触发条件
  - 新增/删除 ETL 脚本
  - 刷新批处理脚本（`.bat`/`.ps1`）变更
  - 数据落库方式变更（例如只落 SQLite、不再生成 Parquet）
- 必须同步
  - `docs/02_technical/` 下对应的 ETL/架构说明
  - `docs/01_user_guide/` 下运行方式/刷新方式（如涉及用户使用）
  - 如有变更记录：追加到 `docs/04_reports_archive/` 的相应报告或创建新报告

### 4.2 数据库 Schema 或 View 变更

- 触发条件
  - `init_schema_v2.sql` 变更
  - 新增/删除 `raw_` 表、`v_` 视图
  - 视图字段（如 `v_mes_metrics`）新增/修改计算逻辑
- 必须同步
  - 数据字典（字段说明、来源、关联键、口径）
  - 任何依赖该表/视图的 KPI 说明文档（例如 SA/LT）

### 4.3 KPI 计算逻辑变更

- 触发条件
  - `etl_kpi_aggregation.py`、`v_mes_metrics` 等 KPI 核心逻辑变更
- 必须同步
  - KPI 技术说明文档（公式、口径、样例）
  - 验证脚本或验证报告（如有）

---

## 5. 数据库 V2 文档入口（建议的落点）

数据库 V2 的“字段说明 / 来源 / 对照表”应集中放在：

- `docs/02_technical/database/`
  - `data_dictionary/`（字段映射、跨表对照、计算逻辑索引）
  - `schema/`（表清单、视图清单）

迁移过程中允许临时保留原始文档，但最终以 `docs/` 下版本为准。

---

## 6. AI 工作规则（必须遵守）

当你（AI）执行任何代码修改时：

- 在改动前
  - 优先定位“权威文档”是否已存在（在 `docs/` 内搜索）。
  - 如果已有同主题文档：**只更新既有文档，不新建重复文档**。
- 在改动后
  - 若变更触发第 4 节条件：必须同步更新文档。
  - 文档更新至少包含：变更点、影响范围、更新日期。
- 禁止行为
  - 不得把同一主题文档同时维护在 `docs/` 和 `documentation/`。
  - 不得新增 Parquet 输出等与 V2“只更新 SQLite”冲突的描述。

---

## 7. 提交前自检（Checklist）

- [ ] 新增/修改的文档是否都在 `docs/` 下？
- [ ] 是否出现了重复主题文档？如有，是否合并并留下指路页？
- [ ] 数据库表/字段名是否保持英文，引用是否使用反引号？
- [ ] 变更是否已在 `docs/README.md` 中添加入口链接？

